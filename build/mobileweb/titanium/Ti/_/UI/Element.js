define(["Ti/_/css","Ti/_/declare","Ti/_/dom","Ti/_/event","Ti/_/has","Ti/_/lang","Ti/_/style","Ti/_/Evented","Ti/UI","Ti/UI/Animation"],function(e,t,i,o,a,n,r,l,s,d){var _=window,c=i.unitize,u=i.computeSize,h=require.on,f=r.set,y=require.is,p=n.isDef,g={post:"_doBackground"},v=function(e,t){return(null===e||!y(e,"String")&&!y(e,"Number"))&&(e=void 0),e!==t&&!this._batchUpdateInProgress&&this._triggerLayout(),e},I={set:v},w="px",m=a("touch");return t("Ti._.UI.Element",l,{domType:null,domNode:null,_alive:1,constructor:function(){var t=this,a=0;t.domNode=t._setFocusNode(i.create(t.domType||"div",{className:"TiUIElement "+e.clean(t.declaredClass),"data-widget-id":t.widgetId})),t._children=[],h(t,"touchstart",t,"_doBackground"),h(t,"touchend",t,"_doBackground"),h(t.domNode,m?"touchstart":"mousedown",function(e){var i=[h(_,m?"touchmove":"mousemove",function(e){(m||a)&&(e._elements||(e._elements=[])).push(t)}),h(_,m?"touchend":"mouseup",function(e){a=0,(e._elements||(e._elements=[])).push(t),o.off(i)}),m&&h(_,"touchcancel",function(e){(e._elements||(e._elements=[])).push(t),o.off(i)})];a=1,(e._elements||(e._elements=[])).push(t)});var n=t.constants.__values__;t._layoutCoefficients={width:{x1:0,x2:0,x3:0},minWidth:{x1:0,x2:0,x3:0},sandboxWidth:{x1:0,x2:0,x3:0},height:{x1:0,x2:0,x3:0},minHeight:{x1:0,x2:0,x3:0},sandboxHeight:{x1:0,x2:0,x3:0},left:{x1:0,x2:0,x3:0},top:{x1:0,x2:0,x3:0,x4:0}},n.size={x:0,y:0,width:0,height:0},n.rect={x:0,y:0,width:0,height:0}},fireEvent:function(e,t){t=t||{};var i,o=t.bubbles;l.fireEvent.call(this,e,t),o&&!t.cancelBubble&&this.bubbleParent&&this._parent&&(p(t.x)&&(i=this.convertPointToView({x:t.x,y:t.y},this._parent),t.x=i?i.x:t.x,t.y=i?i.y:t.y),this._parent.fireEvent(e,t))},_setParent:function(e){this._parent=e},_add:function(e,t){e._hidden=t,e._setParent(this),this._children.push(e),this.containerNode.appendChild(e.domNode),e._triggerLayout()},_insertAt:function(e,t,i){var o=this._children;t>o.length||0>t||(t===o.length?this._add(e,i):(e._parent=this,this.containerNode.insertBefore(e.domNode,o[t].domNode),o.splice(t,0,e),this._triggerLayout()))},_remove:function(e){var t=this._children,o=t.indexOf(e);-1!==o&&(t.splice(o,1),e._setParent(),i.detach(e.domNode),this._triggerLayout())},_removeAllChildren:function(){for(var e=this._children;e.length;)this.remove(e[0]);this._triggerLayout()},destroy:function(){if(this._alive){for(var e=this._children;e.length;)e.splice(0,1)[0].destroy();this._parent&&this._parent._remove(this),this.domNode&&(i.destroy(this.domNode),this.domNode=null)}l.destroy.apply(this,arguments)},_isAttachedToActiveWin:function(){for(var e=!1,t=this;t;){if(t===s._container){e=!0;break}t=t._parent}return e},_needsMeasuring:!0,_triggerLayout:function(e){this._needsMeasuring=!0,this._isAttachedToActiveWin()&&(!this._batchUpdateInProgress||e)&&s._triggerLayout(this,e)},_hasSizeDimensions:function(){return this._hasSizeWidth()||this._hasSizeHeight()},_hasSizeHeight:function(){return isNaN(this._layoutCoefficients.height.x1)},_hasSizeWidth:function(){return isNaN(this._layoutCoefficients.width.x1)},startLayout:function(){this._batchUpdateInProgress=!0},finishLayout:function(){this._batchUpdateInProgress=!1,s._triggerLayout(this,!0)},updateLayout:function(e){this.startLayout();for(var t=0,i=e.length;i>t;t++)this[t]=e[t];this.finishLayout()},convertPointToView:function(e,t){function i(e,t,i){for(var o=t.x,a=t.y,n=i?1:-1;e;)o+=n*e.domNode.offsetLeft,a+=n*e.domNode.offsetTop,e=e._parent;return{x:o,y:a}}if(!this._isAttachedToActiveWin()||!t._isAttachedToActiveWin())return null;if(!e||!y(e.x,"Number")||!y(e.y,"Number"))throw Error("Invalid point");if(!t.domNode)throw Error("Invalid destination view");return i(t,i(this,e,!0),!1)},_getContentOffset:function(){return{x:0,y:0}},_computeGradient:function(){var e=this.backgroundGradient;colors=e.colors,type=e.type,cssVal=type+"-gradient(";var t=u(e.startPoint.x,this._measuredWidth),i=u(e.startPoint.y,this._measuredHeight),o=u("50%",this._measuredWidth),a=u("50%",this._measuredHeight),n=colors.length;if("linear"===type){var r,l,s=u(e.endPoint.x,this._measuredWidth),d=u(e.endPoint.y,this._measuredHeight);if(.01>Math.abs(t-s))d>i?(r=i,l=d,cssVal+="270deg"):(r=d,l=i,cssVal+="90deg");else if(.01>Math.abs(i-d))s>t?(r=t,l=s,cssVal+="0deg"):(r=s,l=t,cssVal+="180deg");else{var _=!1;if(t>s){_=!0;var c=t;t=s,s=c,c=i,i=d,d=c}var h=Math.atan2(d-i,s-t);if(tanAngle=Math.tan(h),cosAngle=Math.cos(h),originLineIntersection=a-o*tanAngle,userDistance=(i-t*tanAngle-originLineIntersection)*cosAngle,userXOffset=userDistance*Math.sin(h),userYOffset=userDistance*cosAngle,t+=userXOffset,i-=userYOffset,s+=userXOffset,d-=userYOffset,shiftedAngle=Math.PI/2-h,h>0){var p=originLineIntersection*Math.sin(shiftedAngle),g=-p*Math.cos(shiftedAngle),v=p*Math.sin(shiftedAngle);r=Math.sqrt(Math.pow(t-g,2)+Math.pow(i-v,2)),l=Math.sqrt(Math.pow(s-g,2)+Math.pow(d-v,2))}else{var p=(this._measuredHeight-originLineIntersection)*Math.sin(shiftedAngle),g=-p*Math.cos(shiftedAngle),v=this._measuredHeight-p*Math.sin(shiftedAngle);r=Math.sqrt(Math.pow(t-g,2)+Math.pow(i-v,2)),l=Math.sqrt(Math.pow(s-g,2)+Math.pow(d-v,2))}h=_?h+Math.PI:h,cssVal+=Math.round(360*(2*Math.PI-h)/(2*Math.PI))+"deg"}for(var I=0;n>I;I++){var m=colors[I];y(m,"String")&&(m={color:m}),y(m.offset,"Number")||(m.offset=I/(n-1)),cssVal+=","+m.color+" "+Math.round(u(100*m.offset+"%",l-r)+r)+w}}else if("radial"===type){var b=Math.min(this._measuredWidth,this._measuredHeight),T=u(e.startRadius,b),E=u(e.endRadius,b),C=[],_=!1;if(T>E){var c=T;T=E,E=c,_=!0;for(var I=0;(n-2)/2>=I;I++){var x=n-I-1;C[I]=colors[x],C[x]=colors[I]}if(1===n%2){var S=Math.floor(n/2);C[S]=colors[S]}}else for(var I=0;n>I;I++)C[I]=colors[I];cssVal+=t+w+" "+i+w;for(var I=0;n>I;I++){var m=C[I];y(m,"String")&&(m={color:m});var k;k=y(m.offset,"Number")?_?1===n%2&&I===Math.floor(n/2)?m.offset:1-m.offset:m.offset:I/(n-1),cssVal+=","+m.color+" "+Math.round(u(100*k+"%",E-T)+T)+w}}require.config.vendorPrefixes.css.forEach(function(e){f(this.domNode,"backgroundImage",e+cssVal+")")},this)},_defaultBackgroundColor:void 0,_defaultBackgroundImage:void 0,_defaultBackgroundDisabledColor:void 0,_defaultBackgroundDisabledImage:void 0,_defaultBackgroundFocusedColor:void 0,_defaultBackgroundFocusedImage:void 0,_defaultBackgroundSelectedColor:void 0,_defaultBackgroundSelectedImage:void 0,_borderLeftWidth:0,_borderRightWidth:0,_borderTopWidth:0,_borderBottomWidth:0,_getBorderFromCSS:function(){setTimeout(n.hitch(this,function(){var e=_.getComputedStyle(this.domNode),t=parseInt(e["border-left-width"]),i=parseInt(e["border-right-width"]),o=parseInt(e["border-top-width"]),a=parseInt(e["border-bottom-width"]);isNaN(t)||isNaN(i)||isNaN(o)||isNaN(a)||(this.borderWidth=t===i&&t===o&&t===a?t:[t,i,o,a])}),1)},_doBackground:function(e){if(!this.backgroundGradient){e=e||{};var t,i=(e.type||"").match(/mouse(over|out)/),o=this.backgroundImage||this._defaultBackgroundImage||"none",a=this.backgroundColor||this._defaultBackgroundColor,n=this.backgroundRepeat,l=this.domNode.style;this._touching&&(a=this.backgroundSelectedColor||this._defaultBackgroundSelectedColor||a,o=this.backgroundSelectedImage||this._defaultBackgroundSelectedImage||o),i&&(this._over="over"===i[1]),!this._touching&&this.focusable&&this._over&&(a=this.backgroundFocusedColor||this._defaultBackgroundFocusedColor||a,o=this.backgroundFocusedImage||this._defaultBackgroundFocusedImage||o),this.enabled||(a=this.backgroundDisabledColor||this._defaultBackgroundDisabledColor||a,o=this.backgroundDisabledImage||this._defaultBackgroundDisabledImage||o),a=a||(o&&"none"!==o?"transparent":""),l.backgroundColor.toLowerCase()!==a.toLowerCase()&&(l.backgroundColor=a),o=r.url(o),l.backgroundImage.replace(/'|"/g,"").toLowerCase()!==o.toLowerCase()&&(l.backgroundImage=o),o&&(t=n?"repeat":"no-repeat",l.backgroundRepeat!==t&&(l.backgroundRepeat=t),t=n?"auto":"100% 100%",l.backgroundSize.replace(/(100%) 100%/,"$1")!==t&&(l.backgroundSize=t))}},_setFocusNode:function(e){var t=this._focus=this._focus||{};return t.node!==e&&(t.node&&(o.off(t.evts),o.off(t.evtsMore)),t.node=e,t.evts=[h(e,"focus",this,"_doBackground"),h(e,"blur",this,"_doBackground")]),e},show:function(){this.visible=!0},hide:function(){this.visible=!1},animate:function(e,t){return this._isAttachedToActiveWin()&&d._play(this,e&&"Ti.UI.Animation"===e.declaredClass?e:new d(e)).then(t)},_setTouchEnabled:function(e){var t,i=this._children,o=0,a=i.length;for(f(this.domNode,"pointerEvents",e?"auto":"none");a>o;o++)t=i[o],t._setTouchEnabled(e&&t.touchEnabled)},_measuredLeft:0,_measuredTop:0,_measuredWidth:0,_measuredHeight:0,_measuredSandboxWidth:0,_measuredSandboxHeight:0,constants:{size:{get:function(){return{x:0,y:0,width:this._measuredWidth,height:this._measuredHeight}}},rect:{get:function(){return{x:this._measuredLeft,y:this._measuredTop,width:this._measuredWidth,height:this._measuredHeight}}},parent:function(){return this._parent}},properties:{backgroundColor:g,backgroundDisabledColor:g,backgroundDisabledImage:g,backgroundFocusedColor:g,backgroundFocusedImage:g,backgroundGradient:{set:function(e){if(y(e.type,"String")&&y(e.colors,"Array")&&!(2>e.colors.length)){var t=e.type,i=e.startPoint,o=e.endPoint;if("linear"===t)i&&"x"in i&&"y"in i||(e.startPoint={x:"0%",y:"50%"}),o&&"x"in o&&"y"in o||(e.endPoint={x:"100%",y:"50%"});else{if("radial"!==t)return;i&&"x"in i&&"y"in i||(e.startPoint={x:"50%",y:"50%"})}return e}},post:function(){this.backgroundGradient&&this._computeGradient()}},backgroundImage:g,backgroundRepeat:g,backgroundSelectedColor:g,backgroundSelectedImage:g,borderColor:{set:function(e){return f(this.domNode,"borderColor",e),e}},borderRadius:{set:function(e){return f(this.domNode,"borderRadius",c(e)),e},value:0},borderWidth:{set:function(e,t){if(y(e,"Array")){if(4!==e.length)return t;f(this.domNode,{borderLeftWidth:(this._borderLeftWidth=e[0])+w,borderRightWidth:(this._borderRightWidth=e[1])+w,borderTopWidth:(this._borderTopWidth=e[2])+w,borderBottomWidth:(this._borderBottomWidth=e[3])+w}),this._borderSet=!0}else{if(isNaN(e))return t;f(this.domNode,"borderWidth",e+w),this._borderLeftWidth=this._borderRightWidth=this._borderTopWidth=this._borderBottomWidth=e,this._borderSet=!0}return e},post:v,value:0},bottom:I,bubbleParent:!0,center:I,color:{set:function(e){return f(this.domNode,"color",e)}},enabled:{post:"_doBackground",set:function(e){return this._focus.node.disabled=!e,e},value:!0},focusable:{value:!1,set:function(e){return i.attr[e?"set":"remove"](this._focus.node,"tabindex",0),e}},_minHeight:I,_maxHeight:I,height:I,left:I,opacity:{set:function(e){return f(this.domNode,"opacity",e)}},visible:{set:function(e,t){return e=!!e,e!==t&&(!e&&(this._lastDisplay=r.get(this.domNode,"display")),f(this.domNode,"display",e?this._lastDisplay||"":"none"),e&&void 0!==t&&this._triggerLayout()),e}},right:I,touchEnabled:{set:function(e){return this._setTouchEnabled(e),e},value:!0},top:I,transform:{set:function(e){return f(this.domNode,"transform",e&&e.toCSS()),this._curTransform=e}},_minWidth:I,_maxWidth:I,width:I,zIndex:I}})});