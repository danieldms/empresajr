define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,t,i,o){var n=o.isDef,r=Math.round;return t("Ti._.Layouts.Vertical",e,{_doLayout:function(e,t,o,n,a){var s,l,d,c,u,_,h,f,g,p,v,y,m,w,T,b={width:0,height:0},I=e._children,E=0,x="px",C=[],S=0,A=I.length,k=this._measureNode;for(E=0;A>E;E++)s=e._children[E],s._alive&&s.domNode?(s._measuredRunningHeight=S,s._markedForLayout&&((s._preLayout&&s._preLayout(t,o,n,a)||s._needsMeasuring)&&k(s,s,s._layoutCoefficients,this),l=s._layoutCoefficients,d=l.width,c=l.height,u=l.sandboxWidth,_=l.sandboxHeight,f=l.left,h=l.top,p=d.x1*t+d.x2,v=c.x1*o+c.x2*(o-S)+c.x3,g=s._getContentSize?s._getContentSize(p,v):s._layout._doLayout(s,isNaN(p)?t:p-s._borderLeftWidth-s._borderRightWidth,isNaN(v)?o:v-s._borderTopWidth-s._borderBottomWidth,isNaN(p),isNaN(v)),isNaN(p)&&(p=g.width+s._borderLeftWidth+s._borderRightWidth),isNaN(v)&&(v=g.height+s._borderTopWidth+s._borderBottomWidth),s._measuredWidth=p,s._measuredHeight=v,n&&0!==f.x1?C.push(s):(w=s._measuredLeft=f.x1*t+f.x2*p+f.x3,m=s._measuredSandboxWidth=u.x1*t+u.x2+p+(isNaN(w)?0:w)),s._measuredTop=h.x1*o+h.x2+S,y=s._measuredSandboxHeight=_.x1*o+_.x2+v),s._measuredSandboxWidth>b.width&&(b.width=s._measuredSandboxWidth),S=b.height+=s._measuredSandboxHeight):this.handleInvalidState(s,e);for(A=C.length,E=0;A>E;E++)s=C[E],u=s._layoutCoefficients.sandboxWidth,m=s._measuredSandboxWidth=u.x1*t+u.x2+s._measuredWidth,m>b.width&&(b.width=m);for(E=0;A>E;E++)s=C[E],f=s._layoutCoefficients.left,u=s._layoutCoefficients.sandboxWidth,p=s._measuredWidth,m=s._measuredSandboxWidth,m>b.width&&(b.width=m),w=s._measuredLeft=f.x1*b.width+f.x2*p+f.x3,s._measuredSandboxWidth+=isNaN(w)?0:w;for(A=I.length,E=0;A>E;E++)s=I[E],s._markedForLayout&&(i._elementLayoutCount++,s=I[E],T=s.domNode.style,T.zIndex=s.zIndex,T.left=r(s._measuredLeft)+x,T.top=r(s._measuredTop)+x,T.width=r(s._measuredWidth-s._borderLeftWidth-s._borderRightWidth)+x,T.height=r(s._measuredHeight-s._borderTopWidth-s._borderBottomWidth)+x,s._markedForLayout=!1,s.fireEvent("postlayout"));return this._computedSize=b},_getWidth:function(e,t){return!n(t)&&2>n(e.left)+n(e.center&&e.center.x)+n(e.right)&&(t=e._defaultWidth),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_getHeight:function(e,t){return!n(t)&&(t=e._defaultHeight),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._parent.height)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.height.x1)&&0!==t.height.x1||!isNaN(t.height.x2)&&0!==t.height.x2||0!==t.sandboxWidth.x1||0!==t.sandboxHeight.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,o=e._parent._measuredHeight,n=e._measuredRunningHeight,r=t.width.x1*i+t.width.x2;return{width:r,height:t.height.x1*o+t.height.x2*(o-n)+t.height.x3,left:t.left.x1*i+t.left.x2*r+t.left.x3,top:t.top.x1*o+t.top.x2+n}},_measureNode:function(e,t,o,n){e._needsMeasuring=!1;var r,a,s,l=n.getValueType,d=n.computeValue,c=n._getWidth(e,t.width),u=l(c),_=d(c,u),h=n._getHeight(e,t.height),f=l(h),g=d(h,f),p=t.left,v=l(p),y=d(p,v),m=t.center&&t.center.x,w=l(m),T=d(m,w),b=t.right,I=l(b),E=d(b,I),x=t.top,C=l(x),S=d(x,C),A=t.bottom,k=l(A),N=d(A,k),L=o.width,O=o.height,U=o.sandboxWidth,R=o.sandboxHeight,F=o.left,V=o.top;if(r=a=0,u===i.SIZE?r=a=0/0:u===i.FILL?(r=1,"%"===v?r-=y:"#"===v?a=-y:"%"===I?r-=E:"#"===I&&(a=-E)):"%"===u?r=_:"#"===u?a=_:"%"===v?"%"===w?r=2*(T-y):"#"===w?(r=-2*y,a=2*T):"%"===I?r=1-y-E:"#"===I&&(r=1-y,a=-E):"#"===v?"%"===w?(r=2*T,a=-2*y):"#"===w?a=2*(T-y):"%"===I?(r=1-E,a=-y):"#"===I&&(r=1,a=-E-y):"%"===w?"%"===I?r=2*(E-T):"#"===I&&(r=-2*T,a=2*E):"#"===w&&("%"===I?(r=2*E,a=-2*T):"#"===I&&(a=2*(E-T))),L.x1=r,L.x2=a,U.x1="%"===I?E:0,U.x2="#"===I?E:0,r=a=s=0,f===i.SIZE?r=a=s=0/0:f===i.FILL?(a=1,"%"===C&&(r=-S),"#"===C&&(s=-S),"%"===k&&(r=-N),"#"===k&&(s=-N)):"%"===f?r=g:"#"===f&&(s=g),O.x1=r,O.x2=a,O.x3=s,r=a=0,"%"===C&&(r=S),"#"===C&&(a=S),"%"===k&&(r+=N),"#"===k&&(a+=N),R.x1=r,R.x2=a,r=a=s=0,"%"===v)r=y;else if("#"===v)s=y;else if("%"===w)r=T,a=-.5;else if("#"===w)a=-.5,s=T;else if("%"===I)r=1-E,a=-1;else if("#"===I)r=1,a=-1,s=-E;else switch(n._defaultHorizontalAlignment){case"center":r=.5,a=-.5;break;case"end":r=1,a=-1}F.x1=r,F.x2=a,F.x3=s,V.x1="%"===C?S:0,V.x2="#"===C?S:0},_defaultHorizontalAlignment:"center",_defaultVerticalAlignment:"start"})});