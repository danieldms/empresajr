define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,t,i,o){var n=o.isDef,a=Math.round;return t("Ti._.Layouts.Vertical",e,{_doLayout:function(e,t,o,n,r){var s,l,d,_,c,u,h,f,g,p,y,v,m,w,I,b={width:0,height:0},T=e._children,x=0,E="px",C=[],S=0,k=T.length,A=this._measureNode;for(x=0;k>x;x++)s=e._children[x],s._alive&&s.domNode?(s._measuredRunningHeight=S,s._markedForLayout&&((s._preLayout&&s._preLayout(t,o,n,r)||s._needsMeasuring)&&A(s,s,s._layoutCoefficients,this),l=s._layoutCoefficients,d=l.width,_=l.height,c=l.sandboxWidth,u=l.sandboxHeight,f=l.left,h=l.top,p=d.x1*t+d.x2,y=_.x1*o+_.x2*(o-S)+_.x3,g=s._getContentSize?s._getContentSize(p,y):s._layout._doLayout(s,isNaN(p)?t:p-s._borderLeftWidth-s._borderRightWidth,isNaN(y)?o:y-s._borderTopWidth-s._borderBottomWidth,isNaN(p),isNaN(y)),isNaN(p)&&(p=g.width+s._borderLeftWidth+s._borderRightWidth),isNaN(y)&&(y=g.height+s._borderTopWidth+s._borderBottomWidth),s._measuredWidth=p,s._measuredHeight=y,n&&0!==f.x1?C.push(s):(w=s._measuredLeft=f.x1*t+f.x2*p+f.x3,m=s._measuredSandboxWidth=c.x1*t+c.x2+p+(isNaN(w)?0:w)),s._measuredTop=h.x1*o+h.x2+S,v=s._measuredSandboxHeight=u.x1*o+u.x2+y),s._measuredSandboxWidth>b.width&&(b.width=s._measuredSandboxWidth),S=b.height+=s._measuredSandboxHeight):this.handleInvalidState(s,e);for(k=C.length,x=0;k>x;x++)s=C[x],c=s._layoutCoefficients.sandboxWidth,m=s._measuredSandboxWidth=c.x1*t+c.x2+s._measuredWidth,m>b.width&&(b.width=m);for(x=0;k>x;x++)s=C[x],f=s._layoutCoefficients.left,c=s._layoutCoefficients.sandboxWidth,p=s._measuredWidth,m=s._measuredSandboxWidth,m>b.width&&(b.width=m),w=s._measuredLeft=f.x1*b.width+f.x2*p+f.x3,s._measuredSandboxWidth+=isNaN(w)?0:w;for(k=T.length,x=0;k>x;x++)s=T[x],s._markedForLayout&&(i._elementLayoutCount++,s=T[x],I=s.domNode.style,I.zIndex=s.zIndex,I.left=a(s._measuredLeft)+E,I.top=a(s._measuredTop)+E,I.width=a(s._measuredWidth-s._borderLeftWidth-s._borderRightWidth)+E,I.height=a(s._measuredHeight-s._borderTopWidth-s._borderBottomWidth)+E,s._markedForLayout=!1,s.fireEvent("postlayout"));return this._computedSize=b},_getWidth:function(e,t){return!n(t)&&2>n(e.left)+n(e.center&&e.center.x)+n(e.right)&&(t=e._defaultWidth),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_getHeight:function(e,t){return!n(t)&&(t=e._defaultHeight),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._parent.height)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.height.x1)&&0!==t.height.x1||!isNaN(t.height.x2)&&0!==t.height.x2||0!==t.sandboxWidth.x1||0!==t.sandboxHeight.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,o=e._parent._measuredHeight,n=e._measuredRunningHeight,a=t.width.x1*i+t.width.x2;return{width:a,height:t.height.x1*o+t.height.x2*(o-n)+t.height.x3,left:t.left.x1*i+t.left.x2*a+t.left.x3,top:t.top.x1*o+t.top.x2+n}},_measureNode:function(e,t,o,n){e._needsMeasuring=!1;var a,r,s,l=n.getValueType,d=n.computeValue,_=n._getWidth(e,t.width),c=l(_),u=d(_,c),h=n._getHeight(e,t.height),f=l(h),g=d(h,f),p=t.left,y=l(p),v=d(p,y),m=t.center&&t.center.x,w=l(m),I=d(m,w),b=t.right,T=l(b),x=d(b,T),E=t.top,C=l(E),S=d(E,C),k=t.bottom,A=l(k),N=d(k,A),L=o.width,F=o.height,U=o.sandboxWidth,V=o.sandboxHeight,O=o.left,R=o.top;if(a=r=0,c===i.SIZE?a=r=0/0:c===i.FILL?(a=1,"%"===y?a-=v:"#"===y?r=-v:"%"===T?a-=x:"#"===T&&(r=-x)):"%"===c?a=u:"#"===c?r=u:"%"===y?"%"===w?a=2*(I-v):"#"===w?(a=-2*v,r=2*I):"%"===T?a=1-v-x:"#"===T&&(a=1-v,r=-x):"#"===y?"%"===w?(a=2*I,r=-2*v):"#"===w?r=2*(I-v):"%"===T?(a=1-x,r=-v):"#"===T&&(a=1,r=-x-v):"%"===w?"%"===T?a=2*(x-I):"#"===T&&(a=-2*I,r=2*x):"#"===w&&("%"===T?(a=2*x,r=-2*I):"#"===T&&(r=2*(x-I))),L.x1=a,L.x2=r,U.x1="%"===T?x:0,U.x2="#"===T?x:0,a=r=s=0,f===i.SIZE?a=r=s=0/0:f===i.FILL?(r=1,"%"===C&&(a=-S),"#"===C&&(s=-S),"%"===A&&(a=-N),"#"===A&&(s=-N)):"%"===f?a=g:"#"===f&&(s=g),F.x1=a,F.x2=r,F.x3=s,a=r=0,"%"===C&&(a=S),"#"===C&&(r=S),"%"===A&&(a+=N),"#"===A&&(r+=N),V.x1=a,V.x2=r,a=r=s=0,"%"===y)a=v;else if("#"===y)s=v;else if("%"===w)a=I,r=-.5;else if("#"===w)r=-.5,s=I;else if("%"===T)a=1-x,r=-1;else if("#"===T)a=1,r=-1,s=-x;else switch(n._defaultHorizontalAlignment){case"center":a=.5,r=-.5;break;case"end":a=1,r=-1}O.x1=a,O.x2=r,O.x3=s,R.x1="%"===C?S:0,R.x2="#"===C?S:0},_defaultHorizontalAlignment:"center",_defaultVerticalAlignment:"start"})});