define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,t,i,o){var a=o.isDef,n=Math.round;return t("Ti._.Layouts.Vertical",e,{_doLayout:function(e,t,o,a,r){var l,s,d,_,c,u,h,f,y,p,g,v,I,w,m,b={width:0,height:0},T=e._children,E=0,C="px",x=[],S=0,k=T.length,A=this._measureNode;for(E=0;k>E;E++)l=e._children[E],l._alive&&l.domNode?(l._measuredRunningHeight=S,l._markedForLayout&&((l._preLayout&&l._preLayout(t,o,a,r)||l._needsMeasuring)&&A(l,l,l._layoutCoefficients,this),s=l._layoutCoefficients,d=s.width,_=s.height,c=s.sandboxWidth,u=s.sandboxHeight,f=s.left,h=s.top,p=d.x1*t+d.x2,g=_.x1*o+_.x2*(o-S)+_.x3,y=l._getContentSize?l._getContentSize(p,g):l._layout._doLayout(l,isNaN(p)?t:p-l._borderLeftWidth-l._borderRightWidth,isNaN(g)?o:g-l._borderTopWidth-l._borderBottomWidth,isNaN(p),isNaN(g)),isNaN(p)&&(p=y.width+l._borderLeftWidth+l._borderRightWidth),isNaN(g)&&(g=y.height+l._borderTopWidth+l._borderBottomWidth),l._measuredWidth=p,l._measuredHeight=g,a&&0!==f.x1?x.push(l):(w=l._measuredLeft=f.x1*t+f.x2*p+f.x3,I=l._measuredSandboxWidth=c.x1*t+c.x2+p+(isNaN(w)?0:w)),l._measuredTop=h.x1*o+h.x2+S,v=l._measuredSandboxHeight=u.x1*o+u.x2+g),l._measuredSandboxWidth>b.width&&(b.width=l._measuredSandboxWidth),S=b.height+=l._measuredSandboxHeight):this.handleInvalidState(l,e);for(k=x.length,E=0;k>E;E++)l=x[E],c=l._layoutCoefficients.sandboxWidth,I=l._measuredSandboxWidth=c.x1*t+c.x2+l._measuredWidth,I>b.width&&(b.width=I);for(E=0;k>E;E++)l=x[E],f=l._layoutCoefficients.left,c=l._layoutCoefficients.sandboxWidth,p=l._measuredWidth,I=l._measuredSandboxWidth,I>b.width&&(b.width=I),w=l._measuredLeft=f.x1*b.width+f.x2*p+f.x3,l._measuredSandboxWidth+=isNaN(w)?0:w;for(k=T.length,E=0;k>E;E++)l=T[E],l._markedForLayout&&(i._elementLayoutCount++,l=T[E],m=l.domNode.style,m.zIndex=l.zIndex,m.left=n(l._measuredLeft)+C,m.top=n(l._measuredTop)+C,m.width=n(l._measuredWidth-l._borderLeftWidth-l._borderRightWidth)+C,m.height=n(l._measuredHeight-l._borderTopWidth-l._borderBottomWidth)+C,l._markedForLayout=!1,l.fireEvent("postlayout"));return this._computedSize=b},_getWidth:function(e,t){return!a(t)&&2>a(e.left)+a(e.center&&e.center.x)+a(e.right)&&(t=e._defaultWidth),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_getHeight:function(e,t){return!a(t)&&(t=e._defaultHeight),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._parent.height)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.height.x1)&&0!==t.height.x1||!isNaN(t.height.x2)&&0!==t.height.x2||0!==t.sandboxWidth.x1||0!==t.sandboxHeight.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,o=e._parent._measuredHeight,a=e._measuredRunningHeight,n=t.width.x1*i+t.width.x2;return{width:n,height:t.height.x1*o+t.height.x2*(o-a)+t.height.x3,left:t.left.x1*i+t.left.x2*n+t.left.x3,top:t.top.x1*o+t.top.x2+a}},_measureNode:function(e,t,o,a){e._needsMeasuring=!1;var n,r,l,s=a.getValueType,d=a.computeValue,_=a._getWidth(e,t.width),c=s(_),u=d(_,c),h=a._getHeight(e,t.height),f=s(h),y=d(h,f),p=t.left,g=s(p),v=d(p,g),I=t.center&&t.center.x,w=s(I),m=d(I,w),b=t.right,T=s(b),E=d(b,T),C=t.top,x=s(C),S=d(C,x),k=t.bottom,A=s(k),L=d(k,A),N=o.width,U=o.height,F=o.sandboxWidth,O=o.sandboxHeight,V=o.left,R=o.top;if(n=r=0,c===i.SIZE?n=r=0/0:c===i.FILL?(n=1,"%"===g?n-=v:"#"===g?r=-v:"%"===T?n-=E:"#"===T&&(r=-E)):"%"===c?n=u:"#"===c?r=u:"%"===g?"%"===w?n=2*(m-v):"#"===w?(n=-2*v,r=2*m):"%"===T?n=1-v-E:"#"===T&&(n=1-v,r=-E):"#"===g?"%"===w?(n=2*m,r=-2*v):"#"===w?r=2*(m-v):"%"===T?(n=1-E,r=-v):"#"===T&&(n=1,r=-E-v):"%"===w?"%"===T?n=2*(E-m):"#"===T&&(n=-2*m,r=2*E):"#"===w&&("%"===T?(n=2*E,r=-2*m):"#"===T&&(r=2*(E-m))),N.x1=n,N.x2=r,F.x1="%"===T?E:0,F.x2="#"===T?E:0,n=r=l=0,f===i.SIZE?n=r=l=0/0:f===i.FILL?(r=1,"%"===x&&(n=-S),"#"===x&&(l=-S),"%"===A&&(n=-L),"#"===A&&(l=-L)):"%"===f?n=y:"#"===f&&(l=y),U.x1=n,U.x2=r,U.x3=l,n=r=0,"%"===x&&(n=S),"#"===x&&(r=S),"%"===A&&(n+=L),"#"===A&&(r+=L),O.x1=n,O.x2=r,n=r=l=0,"%"===g)n=v;else if("#"===g)l=v;else if("%"===w)n=m,r=-.5;else if("#"===w)r=-.5,l=m;else if("%"===T)n=1-E,r=-1;else if("#"===T)n=1,r=-1,l=-E;else switch(a._defaultHorizontalAlignment){case"center":n=.5,r=-.5;break;case"end":n=1,r=-1}V.x1=n,V.x2=r,V.x3=l,R.x1="%"===x?S:0,R.x2="#"===x?S:0},_defaultHorizontalAlignment:"center",_defaultVerticalAlignment:"start"})});