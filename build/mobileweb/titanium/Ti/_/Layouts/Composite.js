define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,t,i,o){var a=o.isDef,n="px",r=Math.round;return t("Ti._.Layouts.Composite",e,{_doLayout:function(e,t,o,a,l){var s,d,_,c,u,h,f,y,p,g,v,I,w,m,b,T,E,C,S={width:0,height:0},k=e._children,x=0,A=[],L=[],N=k.length,U=this._measureNode;for(x=0;N>x;x++)s=e._children[x],s._alive&&s.domNode?(s._markedForLayout&&((s._preLayout&&s._preLayout(t,o,a,l)||s._needsMeasuring)&&U(s,s,s._layoutCoefficients,this),d=s._layoutCoefficients,_=d.width,p=d.minWidth,c=d.height,g=d.minHeight,u=d.sandboxWidth,h=d.sandboxHeight,y=d.left,f=d.top,I=_.x1*t+_.x2,void 0!==p.x1&&(I=Math.max(I,p.x1*t+p.x2)),w=c.x1*o+c.x2,void 0!==g.x1&&(w=Math.max(w,g.x1*o+g.x2)),v=s._getContentSize?s._getContentSize(I,w):s._layout._doLayout(s,isNaN(I)?t:I-s._borderLeftWidth-s._borderRightWidth,isNaN(w)?o:w-s._borderTopWidth-s._borderBottomWidth,isNaN(I),isNaN(w)),isNaN(I)&&(I=v.width+s._borderLeftWidth+s._borderRightWidth,void 0!==p.x1&&(I=Math.max(I,p.x1*t+p.x2))),isNaN(w)&&(w=v.height+s._borderTopWidth+s._borderBottomWidth,void 0!==g.x1&&(w=Math.max(w,g.x1*o+g.x2))),a&&0!==y.x1?A.push(s):T=y.x1*t+y.x2*I+y.x3,l&&0!==f.x1?L.push(s):E=f.x1*o+f.x2*w+f.x3,s._measuredSandboxWidth=b=u.x1*o+u.x2+I+(isNaN(T)?0:T),s._measuredSandboxHeight=m=h.x1*o+h.x2+w+(isNaN(E)?0:E),s._measuredWidth=I,s._measuredHeight=w,s._measuredLeft=T,s._measuredTop=E),s._measuredSandboxWidth>S.width&&(S.width=s._measuredSandboxWidth),s._measuredSandboxHeight>S.height&&(S.height=s._measuredSandboxHeight)):this.handleInvalidState(s,e);for(N=A.length,x=0;N>x;x++)s=A[x],y=s._layoutCoefficients.left,u=s._layoutCoefficients.sandboxWidth,s._measuredLeft=T=y.x1*S.width+y.x2*I+y.x3,s._measuredSandboxWidth=b=u.x1*o+u.x2+s._measuredWidth+T,b=s._measuredSandboxWidth,b>S.width&&(S.width=b);for(N=L.length,x=0;N>x;x++)s=L[x],f=s._layoutCoefficients.top,h=s._layoutCoefficients.sandboxHeight,s._measuredTop=E=f.x1*S.height+f.x2*w+f.x3,s._measuredSandboxHeight=m=h.x1*o+h.x2+s._measuredHeight+E,m=s._measuredSandboxHeight,m>S.height&&(S.height=m);for(N=k.length,x=0;N>x;x++)s=k[x],s._markedForLayout&&(i._elementLayoutCount++,C=s.domNode.style,C.zIndex=s.zIndex,C.left=r(s._measuredLeft)+n,C.top=r(s._measuredTop)+n,C.width=r(s._measuredWidth-s._borderLeftWidth-s._borderRightWidth)+n,C.height=r(s._measuredHeight-s._borderTopWidth-s._borderBottomWidth)+n,s._markedForLayout=!1,s.fireEvent("postlayout"));return this._computedSize=S},_getWidth:function(e,t){return!a(t)&&2>a(e.left)+a(e.center&&e.center.x)+a(e.right)&&(t=e._defaultWidth),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_getHeight:function(e,t){return!a(t)&&2>a(e.top)+a(e.center&&e.center.y)+a(e.bottom)&&(t=e._defaultHeight),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._parent.height)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.height.x1)&&0!==t.height.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,o=e._parent._measuredHeight,a=t.width.x1*i+t.width.x2,n=t.height.x1*o+t.height.x2;return{width:a,height:n,left:t.left.x1*i+t.left.x2*a+t.left.x3,top:t.top.x1*o+t.top.x2*n+t.top.x3}},_measureNode:function(e,t,o,a){e._needsMeasuring=!1;for(var n,r,l,s,d,_,c,u,h,f,y,p,g,v=a.getValueType,I=a.computeValue,w=a._getWidth(e,t.width),m=v(w),b=I(w,m),T=t._minWidth,E=v(T),C=I(T,E),S=a._getHeight(e,t.height),k=v(S),x=I(S,k),A=t._minHeight,L=v(A),N=I(A,L),U=t.left,F=v(U),O=I(U,F),V=t.center&&t.center.x,P=v(V),z=I(V,P),R=t.right,D=v(R),W=I(R,D),M=t.top,B=v(M),G=I(M,B),H=t.center&&t.center.y,q=v(H),Y=I(H,q),j=t.bottom,$=v(j),X=I(j,$),K=o.sandboxWidth,Z=o.sandboxHeight,J=[[m,b,F,O,P,z,D,W],[k,x,B,G,q,Y,$,X]],Q=0;2>Q;Q++)s=J[Q],d=s[0],_=s[1],c=s[2],u=s[3],h=s[4],f=s[5],y=s[6],p=s[7],n=r=0,d===i.SIZE?n=r=0/0:d===i.FILL?(n=1,"%"===c?n-=u:"#"===c?r=-u:"%"===y?n-=p:"#"===y&&(r=-p)):"%"===d?n=_:"#"===d?r=_:"%"===c?"%"===h?n=2*(f-u):"#"===h?(n=-2*u,r=2*f):"%"===y?n=1-u-p:"#"===y&&(n=1-u,r=-p):"#"===c?"%"===h?(n=2*f,r=-2*u):"#"===h?r=2*(f-u):"%"===y?(n=1-p,r=-u):"#"===y&&(n=1,r=-p-u):"%"===h?"%"===y?n=2*(p-f):"#"===y&&(n=-2*f,r=2*p):"#"===h&&("%"===y?(n=2*p,r=-2*f):"#"===y&&(r=2*(p-f))),o[g=0===Q?"width":"height"].x1=n,o[g].x2=r;J={minWidth:[E,C,F,O,P,z,D,W],minHeight:[L,N,B,G,q,Y,$,X]};for(Q in J)s=J[Q],d=s[0],_=s[1],c=s[2],u=s[3],h=s[4],f=s[5],y=s[6],p=s[7],n=r=l=0,d===i.SIZE?n=r=0/0:d===i.FILL?(n=1,"%"===c?n-=u:"#"===c?r=-u:"%"===y?n-=p:"#"===y&&(r=-p)):"%"===d?n=_:"#"===d?r=_:n=r=l=void 0,o[Q].x1=n,o[Q].x2=r,o[Q].x3=l;for(J=[[F,O,P,z,D,W],[B,G,q,Y,$,X]],Q=0;2>Q;Q++){if(s=J[Q],c=s[0],u=s[1],h=s[2],f=s[3],y=s[4],p=s[5],n=r=l=0,"%"===c)n=u;else if("#"===c)l=u;else if("%"===h)n=f,r=-.5;else if("#"===h)r=-.5,l=f;else if("%"===y)n=1-p,r=-1;else if("#"===y)n=1,r=-1,l=-p;else switch("left"===Q?a._defaultHorizontalAlignment:a._defaultVerticalAlignment){case"center":n=.5,r=-.5;break;case"end":n=1,r=-1}o[g=0===Q?"left":"top"].x1=n,o[g].x2=r,o[g].x3=l}K.x1="%"===D?W:0,K.x2="#"===D?W:0,Z.x1="%"===$?X:0,Z.x2="#"===$?X:0},_defaultHorizontalAlignment:"center",_defaultVerticalAlignment:"center"})});