define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,t,i,o){var n=o.isDef,r="px",a=Math.round;return t("Ti._.Layouts.Composite",e,{_doLayout:function(e,t,o,n,s){var l,d,c,u,_,h,f,p,g,v,y,m,w,T,I,b,E,C,x={width:0,height:0},S=e._children,A=0,k=[],N=[],L=S.length,O=this._measureNode;for(A=0;L>A;A++)l=e._children[A],l._alive&&l.domNode?(l._markedForLayout&&((l._preLayout&&l._preLayout(t,o,n,s)||l._needsMeasuring)&&O(l,l,l._layoutCoefficients,this),d=l._layoutCoefficients,c=d.width,g=d.minWidth,u=d.height,v=d.minHeight,_=d.sandboxWidth,h=d.sandboxHeight,p=d.left,f=d.top,m=c.x1*t+c.x2,void 0!==g.x1&&(m=Math.max(m,g.x1*t+g.x2)),w=u.x1*o+u.x2,void 0!==v.x1&&(w=Math.max(w,v.x1*o+v.x2)),y=l._getContentSize?l._getContentSize(m,w):l._layout._doLayout(l,isNaN(m)?t:m-l._borderLeftWidth-l._borderRightWidth,isNaN(w)?o:w-l._borderTopWidth-l._borderBottomWidth,isNaN(m),isNaN(w)),isNaN(m)&&(m=y.width+l._borderLeftWidth+l._borderRightWidth,void 0!==g.x1&&(m=Math.max(m,g.x1*t+g.x2))),isNaN(w)&&(w=y.height+l._borderTopWidth+l._borderBottomWidth,void 0!==v.x1&&(w=Math.max(w,v.x1*o+v.x2))),n&&0!==p.x1?k.push(l):b=p.x1*t+p.x2*m+p.x3,s&&0!==f.x1?N.push(l):E=f.x1*o+f.x2*w+f.x3,l._measuredSandboxWidth=I=_.x1*o+_.x2+m+(isNaN(b)?0:b),l._measuredSandboxHeight=T=h.x1*o+h.x2+w+(isNaN(E)?0:E),l._measuredWidth=m,l._measuredHeight=w,l._measuredLeft=b,l._measuredTop=E),l._measuredSandboxWidth>x.width&&(x.width=l._measuredSandboxWidth),l._measuredSandboxHeight>x.height&&(x.height=l._measuredSandboxHeight)):this.handleInvalidState(l,e);for(L=k.length,A=0;L>A;A++)l=k[A],p=l._layoutCoefficients.left,_=l._layoutCoefficients.sandboxWidth,l._measuredLeft=b=p.x1*x.width+p.x2*m+p.x3,l._measuredSandboxWidth=I=_.x1*o+_.x2+l._measuredWidth+b,I=l._measuredSandboxWidth,I>x.width&&(x.width=I);for(L=N.length,A=0;L>A;A++)l=N[A],f=l._layoutCoefficients.top,h=l._layoutCoefficients.sandboxHeight,l._measuredTop=E=f.x1*x.height+f.x2*w+f.x3,l._measuredSandboxHeight=T=h.x1*o+h.x2+l._measuredHeight+E,T=l._measuredSandboxHeight,T>x.height&&(x.height=T);for(L=S.length,A=0;L>A;A++)l=S[A],l._markedForLayout&&(i._elementLayoutCount++,C=l.domNode.style,C.zIndex=l.zIndex,C.left=a(l._measuredLeft)+r,C.top=a(l._measuredTop)+r,C.width=a(l._measuredWidth-l._borderLeftWidth-l._borderRightWidth)+r,C.height=a(l._measuredHeight-l._borderTopWidth-l._borderBottomWidth)+r,l._markedForLayout=!1,l.fireEvent("postlayout"));return this._computedSize=x},_getWidth:function(e,t){return!n(t)&&2>n(e.left)+n(e.center&&e.center.x)+n(e.right)&&(t=e._defaultWidth),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_getHeight:function(e,t){return!n(t)&&2>n(e.top)+n(e.center&&e.center.y)+n(e.bottom)&&(t=e._defaultHeight),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._parent.height)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.height.x1)&&0!==t.height.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,o=e._parent._measuredHeight,n=t.width.x1*i+t.width.x2,r=t.height.x1*o+t.height.x2;return{width:n,height:r,left:t.left.x1*i+t.left.x2*n+t.left.x3,top:t.top.x1*o+t.top.x2*r+t.top.x3}},_measureNode:function(e,t,o,n){e._needsMeasuring=!1;for(var r,a,s,l,d,c,u,_,h,f,p,g,v,y=n.getValueType,m=n.computeValue,w=n._getWidth(e,t.width),T=y(w),I=m(w,T),b=t._minWidth,E=y(b),C=m(b,E),x=n._getHeight(e,t.height),S=y(x),A=m(x,S),k=t._minHeight,N=y(k),L=m(k,N),O=t.left,U=y(O),R=m(O,U),F=t.center&&t.center.x,V=y(F),D=m(F,V),P=t.right,M=y(P),B=m(P,M),W=t.top,z=y(W),H=m(W,z),G=t.center&&t.center.y,q=y(G),Y=m(G,q),j=t.bottom,X=y(j),Z=m(j,X),K=o.sandboxWidth,$=o.sandboxHeight,J=[[T,I,U,R,V,D,M,B],[S,A,z,H,q,Y,X,Z]],Q=0;2>Q;Q++)l=J[Q],d=l[0],c=l[1],u=l[2],_=l[3],h=l[4],f=l[5],p=l[6],g=l[7],r=a=0,d===i.SIZE?r=a=0/0:d===i.FILL?(r=1,"%"===u?r-=_:"#"===u?a=-_:"%"===p?r-=g:"#"===p&&(a=-g)):"%"===d?r=c:"#"===d?a=c:"%"===u?"%"===h?r=2*(f-_):"#"===h?(r=-2*_,a=2*f):"%"===p?r=1-_-g:"#"===p&&(r=1-_,a=-g):"#"===u?"%"===h?(r=2*f,a=-2*_):"#"===h?a=2*(f-_):"%"===p?(r=1-g,a=-_):"#"===p&&(r=1,a=-g-_):"%"===h?"%"===p?r=2*(g-f):"#"===p&&(r=-2*f,a=2*g):"#"===h&&("%"===p?(r=2*g,a=-2*f):"#"===p&&(a=2*(g-f))),o[v=0===Q?"width":"height"].x1=r,o[v].x2=a;J={minWidth:[E,C,U,R,V,D,M,B],minHeight:[N,L,z,H,q,Y,X,Z]};for(Q in J)l=J[Q],d=l[0],c=l[1],u=l[2],_=l[3],h=l[4],f=l[5],p=l[6],g=l[7],r=a=s=0,d===i.SIZE?r=a=0/0:d===i.FILL?(r=1,"%"===u?r-=_:"#"===u?a=-_:"%"===p?r-=g:"#"===p&&(a=-g)):"%"===d?r=c:"#"===d?a=c:r=a=s=void 0,o[Q].x1=r,o[Q].x2=a,o[Q].x3=s;for(J=[[U,R,V,D,M,B],[z,H,q,Y,X,Z]],Q=0;2>Q;Q++){if(l=J[Q],u=l[0],_=l[1],h=l[2],f=l[3],p=l[4],g=l[5],r=a=s=0,"%"===u)r=_;else if("#"===u)s=_;else if("%"===h)r=f,a=-.5;else if("#"===h)a=-.5,s=f;else if("%"===p)r=1-g,a=-1;else if("#"===p)r=1,a=-1,s=-g;else switch("left"===Q?n._defaultHorizontalAlignment:n._defaultVerticalAlignment){case"center":r=.5,a=-.5;break;case"end":r=1,a=-1}o[v=0===Q?"left":"top"].x1=r,o[v].x2=a,o[v].x3=s}K.x1="%"===M?B:0,K.x2="#"===M?B:0,$.x1="%"===X?Z:0,$.x2="#"===X?Z:0},_defaultHorizontalAlignment:"center",_defaultVerticalAlignment:"center"})});