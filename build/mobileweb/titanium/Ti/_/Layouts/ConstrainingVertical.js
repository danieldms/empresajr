define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,t,i,o){var n=o.isDef,a=Math.round;return t("Ti._.Layouts.ConstrainingVertical",e,{_doLayout:function(e,t,o,n,r){var l,s,d,_,c,u,h,f,p,y,g,v,m,w,I,b,T,E={width:0,height:0},C=e._children,S=0,x="px",k=[],A=0,N=0,L=C.length,U=this._measureNode;for(S=0;L>S;S++)l=e._children[S],l._alive&&l.domNode?l._markedForLayout&&((l._preLayout&&l._preLayout(t,o,n,r)||l._needsMeasuring)&&U(l,l,l._layoutCoefficients,this),s=l._layoutCoefficients,_=s.height,0===_.x2||isNaN(_.x2)?(d=s.width,c=s.sandboxWidth,u=s.sandboxHeight,y=d.x1*t+d.x2,g=_.x1*o+_.x2*(o-A)+_.x3,p=l._getContentSize?l._getContentSize(y,g):l._layout._doLayout(l,isNaN(y)?t:y-l._borderLeftWidth-l._borderRightWidth,isNaN(g)?o:g-l._borderTopWidth-l._borderBottomWidth,isNaN(y),isNaN(g)),isNaN(y)&&(y=p.width+l._borderLeftWidth+l._borderRightWidth),isNaN(g)&&(g=p.height+l._borderTopWidth+l._borderBottomWidth),v=l._measuredSandboxHeight=u.x1*o+u.x2+g,A+=v,l._measuredWidth=y,l._measuredHeight=g):N++):this.handleInvalidState(l,e);for(b=o-A,A=Math.floor(b/N),S=0;L>S;S++)l=e._children[S],l._markedForLayout&&(s=l._layoutCoefficients,_=s.height,0===_.x2||isNaN(_.x2)||(d=s.width,c=s.sandboxWidth,u=s.sandboxHeight,y=d.x1*t+d.x2,g=_.x1*o+_.x2*(L-1>S?A:b-A*(N-1))+_.x3,p=l._getContentSize?l._getContentSize(y,g):l._layout._doLayout(l,isNaN(y)?t:y-l._borderLeftWidth-l._borderRightWidth,isNaN(g)?o:g-l._borderTopWidth-l._borderBottomWidth,isNaN(y),isNaN(g)),isNaN(y)&&(y=p.width+l._borderLeftWidth+l._borderRightWidth),isNaN(g)&&(g=p.height+l._borderTopWidth+l._borderBottomWidth),l._measuredWidth=y,l._measuredHeight=g,v=l._measuredSandboxHeight=u.x1*o+u.x2+g));for(A=0,S=0;L>S;S++)l=e._children[S],l._measuredRunningHeight=A,l._markedForLayout?(s=l._layoutCoefficients,c=s.sandboxWidth,h=s.top,f=s.left,n&&0!==f.x1?k.push(l):(y=l._measuredWidth,w=l._measuredLeft=f.x1*t+f.x2*y+f.x3,m=l._measuredSandboxWidth=c.x1*t+c.x2+y+(isNaN(w)?0:w),l._measuredSandboxWidth>E.width&&(E.width=l._measuredSandboxWidth)),I=l._measuredTop=h.x1*o+h.x2+A):l._measuredSandboxWidth>E.width&&(E.width=l._measuredSandboxWidth),A+=l._measuredSandboxHeight;for(E.height=A,L=k.length,S=0;L>S;S++)l=k[S],c=l._layoutCoefficients.sandboxWidth,m=l._measuredSandboxWidth=c.x1*t+c.x2+l._measuredWidth,m>E.width&&(E.width=m);for(S=0;L>S;S++)l=k[S],f=l._layoutCoefficients.left,c=l._layoutCoefficients.sandboxWidth,y=l._measuredWidth,m=l._measuredSandboxWidth,m>E.width&&(E.width=m),w=l._measuredLeft=f.x1*E.width+f.x2*y+f.x3,l._measuredSandboxWidth+=isNaN(w)?0:w;for(L=C.length,S=0;L>S;S++)l=C[S],l._markedForLayout&&(i._elementLayoutCount++,l=C[S],T=l.domNode.style,T.zIndex=l.zIndex,T.left=a(l._measuredLeft)+x,T.top=a(l._measuredTop)+x,T.width=a(l._measuredWidth-l._borderLeftWidth-l._borderRightWidth)+x,T.height=a(l._measuredHeight-l._borderTopWidth-l._borderBottomWidth)+x,l._markedForLayout=!1,l.fireEvent("postlayout"));return this._computedSize=E},_getWidth:function(e,t){return!n(t)&&2>n(e.left)+n(e.center&&e.center.x)+n(e.right)&&(t=e._defaultWidth),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_getHeight:function(e,t){return!n(t)&&(t=e._defaultHeight),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._parent.height)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.height.x1)&&0!==t.height.x1||!isNaN(t.height.x2)&&0!==t.height.x2||0!==t.sandboxWidth.x1||0!==t.sandboxHeight.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,o=e._parent._measuredHeight,n=e._measuredRunningHeight,a=t.width.x1*i+t.width.x2;return{width:a,height:t.height.x1*o+t.height.x2*(o-n)+t.height.x3,left:t.left.x1*i+t.left.x2*a+t.left.x3,top:t.top.x1*o+t.top.x2+n}},_measureNode:function(e,t,o,n){e._needsMeasuring=!1;var a,r,l,s=n.getValueType,d=n.computeValue,_=n._getWidth(e,t.width),c=s(_),u=d(_,c),h=n._getHeight(e,t.height),f=s(h),p=d(h,f),y=t.left,g=s(y),v=d(y,g),m=t.center&&t.center.x,w=s(m),I=d(m,w),b=t.right,T=s(b),E=d(b,T),C=t.top,S=s(C),x=d(C,S),k=t.bottom,A=s(k),N=d(k,A),L=o.width,U=o.height,O=o.sandboxWidth,F=o.sandboxHeight,V=o.left,R=o.top;if(a=r=0,c===i.SIZE?a=r=0/0:c===i.FILL?(a=1,"%"===g?a-=v:"#"===g?r=-v:"%"===T?a-=E:"#"===T&&(r=-E)):"%"===c?a=u:"#"===c?r=u:"%"===g?"%"===w?a=2*(I-v):"#"===w?(a=-2*v,r=2*I):"%"===T?a=1-v-E:"#"===T&&(a=1-v,r=-E):"#"===g?"%"===w?(a=2*I,r=-2*v):"#"===w?r=2*(I-v):"%"===T?(a=1-E,r=-v):"#"===T&&(a=1,r=-E-v):"%"===w?"%"===T?a=2*(E-I):"#"===T&&(a=-2*I,r=2*E):"#"===w&&("%"===T?(a=2*E,r=-2*I):"#"===T&&(r=2*(E-I))),L.x1=a,L.x2=r,O.x1="%"===T?E:0,O.x2="#"===T?E:0,a=r=l=0,f===i.SIZE?a=r=l=0/0:f===i.FILL?(r=1,"%"===S&&(a=-x),"#"===S&&(l=-x),"%"===A&&(a=-N),"#"===A&&(l=-N)):"%"===f?a=p:"#"===f&&(l=p),U.x1=a,U.x2=r,U.x3=l,a=r=0,"%"===S&&(a=x),"#"===S&&(r=x),"%"===A&&(a+=N),"#"===A&&(r+=N),F.x1=a,F.x2=r,a=r=l=0,"%"===g)a=v;else if("#"===g)l=v;else if("%"===w)a=I,r=-.5;else if("#"===w)r=-.5,l=I;else if("%"===T)a=1-E,r=-1;else if("#"===T)a=1,r=-1,l=-E;else switch(n._defaultHorizontalAlignment){case"center":a=.5,r=-.5;break;case"end":a=1,r=-1}V.x1=a,V.x2=r,V.x3=l,R.x1="%"===S?x:0,R.x2="#"===S?x:0},_defaultHorizontalAlignment:"center",_defaultVerticalAlignment:"start"})});