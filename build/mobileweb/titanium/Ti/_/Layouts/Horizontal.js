define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/API","Ti/UI","Ti/_/lang"],function(e,t,i,o,n){var a=n.isDef,r=Math.round,l=Math.floor,s=Math.ceil;return t("Ti._.Layouts.Horizontal",e,{_doLayout:function(e,t,n,a,d){var _,c,u,h,f,y,p,g,v,m,w,I,b,T,E,C,x,S,k,A,N={width:0,height:0},L=e._children,U=0,F="px",O=0,V=0,R=[[]],P=[],z=[],W=0,D=L.length,M=this._measureNode;for(U=0;D>U;U++)_=e._children[U],_._alive&&_.domNode?(_._measuredRunningWidth=V,_._markedForLayout&&((_._preLayout&&_._preLayout(t,n,a,d)||_._needsMeasuring)&&M(_,_,_._layoutCoefficients,this),u=_._layoutCoefficients,h=u.width,f=u.height,y=u.sandboxWidth,v=u.left,w=h.x1*t+h.x2*(t-V)+h.x3,I=0===f.x2?f.x1*n+f.x3:0/0,isNaN(w)||isNaN(f.x1)?(m=_._getContentSize?_._getContentSize(w,I):_._layout._doLayout(_,isNaN(w)?t:w-_._borderLeftWidth-_._borderRightWidth,isNaN(I)?n:I-_._borderTopWidth-_._borderBottomWidth,isNaN(w),isNaN(I)),isNaN(w)&&(w=m.width+_._borderLeftWidth+_._borderRightWidth),isNaN(f.x1)&&(I=m.height+_._borderTopWidth+_._borderBottomWidth),_._childrenLaidOut=!0,0===f.x2||isNaN(f.x2)||(i.warn("Child of width SIZE and height FILL detected in a horizontal layout. Performance degradation may occur."),_._childrenLaidOut=!1)):_._childrenLaidOut=!1,_._measuredWidth=w,_._measuredHeight=I,T=_._measuredSandboxWidth=y.x1*t+y.x2+w,E=v.x1*t+v.x2+V,!a&&l(T+V)>s(t)&&(R.push([]),E-=V,V=0),_._measuredLeft=E,R[R.length-1].push(_),V+=T),V>N.width&&(N.width=V)):this.handleInvalidState(_,e);for(D=R.length,U=0;D>U;U++){for(x=R[U],S=0,k=x.length,c=0;k>c;c++)_=x[c],_._markedForLayout&&(u=_._layoutCoefficients,g=u.top,f=u.height,p=u.sandboxHeight,I=_._measuredHeight,isNaN(I)&&(_._measuredHeight=I=f.x1*n+f.x2*(n-O)+f.x3),_._childrenLaidOut||(w=_._measuredWidth,_._childrenLaidOut=!0,_._layout._doLayout(_,isNaN(w)?t:w-_._borderLeftWidth-_._borderRightWidth,isNaN(I)?n:I-_._borderTopWidth-_._borderBottomWidth,isNaN(w),isNaN(I))),0!==g.x2?(z.push(_),C=O):_._measuredTop=C=g.x1*n+g.x3*I+g.x4+O,_._measuredSandboxHeight=b=p.x1*n+p.x2+I+C-O,b>S&&(S=b));P.push(S),O+=S}for(O=0,D=R.length,U=0;D>U;U++){for(x=R[U],S=P[U],k=x.length,c=0;k>c;c++)_=x[c],_._measuredRunningHeight=O,_._measuredRowHeight=S,~z.indexOf(_)&&_._markedForLayout&&(I=_._measuredHeight,g=_._layoutCoefficients.top,_._measuredTop=g.x1*n+g.x2*S+g.x3*I+g.x4+O);O+=S}if(N.height=O,!d)switch(this._defaultVerticalAlignment){case"end":W=n-O;case"center":W/=2}for(D=L.length,U=0;D>U;U++)_=L[U],_._markedForLayout&&(o._elementLayoutCount++,_=L[U],A=_.domNode.style,A.zIndex=_.zIndex,A.left=r(_._measuredLeft)+F,A.top=r(_._measuredTop)+F,A.width=r(_._measuredWidth-_._borderLeftWidth-_._borderRightWidth)+F,A.height=r(_._measuredHeight-_._borderTopWidth-_._borderBottomWidth)+F,_._markedForLayout=!1,_.fireEvent("postlayout"));return this._computedSize=N},_getWidth:function(e,t){return!a(t)&&(t=e._defaultWidth),t===o.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===o.SIZE?o.SIZE:o.FILL:o.FILL:t},_getHeight:function(e,t){return!a(t)&&(t=e._defaultHeight),t===o.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._height)===o.SIZE?o.SIZE:o.FILL:o.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.width.x2)&&0!==t.width.x2||!isNaN(t.height.x1)&&0!==t.height.x1||!isNaN(t.height.x2)&&0!==t.height.x2||0!==t.sandboxWidth.x1||0!==t.sandboxHeight.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,o=e._parent._measuredHeight,n=e._measuredHeight,a=e._measuredRunningWidth,r=e._measuredRunningHeight,l=e._measuredRowHeight;return{width:t.width.x1*i+t.width.x2*(i-a)+t.width.x3,height:t.height.x1*o+t.height.x2*(o-r)+t.height.x3,left:t.left.x1*i+t.left.x2+a,top:t.top.x1*o+t.top.x2*l+t.top.x3*n+t.top.x4+r}},_measureNode:function(e,t,i,n){e._needsMeasuring=!1;var a,r,l,s,d=n.getValueType,_=n.computeValue,c=n._getWidth(e,t.width),u=d(c),h=_(c,u),f=n._getHeight(e,t.height),y=d(f),p=_(f,y),g=t.left,v=d(g),m=_(g,v),w=t.right,I=d(w),b=_(w,I),T=t.top,E=d(T),C=_(T,E),x=t.bottom,S=d(x),k=_(x,S),A=i.width,N=i.height,L=i.sandboxWidth,U=i.sandboxHeight,F=i.left,O=i.top;if(a=r=l=0,u===o.SIZE?a=r=l=0/0:u===o.FILL?(r=1,"%"===v&&(a=-m),"#"===v&&(l=-m),"%"===I&&(a=-b),"#"===I&&(l=-b)):"%"===u?a=h:"#"===u&&(l=h),A.x1=a,A.x2=r,A.x3=l,a=r=0,"%"===v&&(a=m),"#"===v&&(r=m),"%"===I&&(a+=b),"#"===I&&(r+=b),L.x1=a,L.x2=r,a=r=l=0,y===o.SIZE?a=r=l=0/0:y===o.FILL?(r=1,"%"===E&&(a=-C),"#"===E&&(l=-C)):"%"===y?a=p:"#"===y&&(l=p),N.x1=a,N.x2=r,N.x3=l,U.x1="%"===S?k:0,U.x2="#"===S?k:0,F.x1="%"===v?m:0,F.x2="#"===v?m:0,a=r=l=s=0,"%"===E)a=C;else if("#"===E)s=C;else if("%"===S)a=1-k,l=-1;else if("#"===S)a=1,l=-1,s=-k;else switch(n._defaultRowAlignment){case"center":r=.5,l=-.5;break;case"end":r=1,l=-1}O.x1=a,O.x2=r,O.x3=l,O.x4=s},_defaultHorizontalAlignment:"start",_defaultVerticalAlignment:"start",_defaultRowAlignment:"center"})});