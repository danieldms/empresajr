define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/API","Ti/UI","Ti/_/lang"],function(e,t,i,o,a){var n=a.isDef,r=Math.round,l=Math.floor,s=Math.ceil;return t("Ti._.Layouts.Horizontal",e,{_doLayout:function(e,t,a,n,d){var _,c,u,h,f,y,p,g,v,I,w,m,b,T,E,C,x,S,k,A,L={width:0,height:0},N=e._children,U=0,F="px",O=0,V=0,R=[[]],z=[],P=[],W=0,D=N.length,M=this._measureNode;for(U=0;D>U;U++)_=e._children[U],_._alive&&_.domNode?(_._measuredRunningWidth=V,_._markedForLayout&&((_._preLayout&&_._preLayout(t,a,n,d)||_._needsMeasuring)&&M(_,_,_._layoutCoefficients,this),u=_._layoutCoefficients,h=u.width,f=u.height,y=u.sandboxWidth,v=u.left,w=h.x1*t+h.x2*(t-V)+h.x3,m=0===f.x2?f.x1*a+f.x3:0/0,isNaN(w)||isNaN(f.x1)?(I=_._getContentSize?_._getContentSize(w,m):_._layout._doLayout(_,isNaN(w)?t:w-_._borderLeftWidth-_._borderRightWidth,isNaN(m)?a:m-_._borderTopWidth-_._borderBottomWidth,isNaN(w),isNaN(m)),isNaN(w)&&(w=I.width+_._borderLeftWidth+_._borderRightWidth),isNaN(f.x1)&&(m=I.height+_._borderTopWidth+_._borderBottomWidth),_._childrenLaidOut=!0,0===f.x2||isNaN(f.x2)||(i.warn("Child of width SIZE and height FILL detected in a horizontal layout. Performance degradation may occur."),_._childrenLaidOut=!1)):_._childrenLaidOut=!1,_._measuredWidth=w,_._measuredHeight=m,T=_._measuredSandboxWidth=y.x1*t+y.x2+w,E=v.x1*t+v.x2+V,!n&&l(T+V)>s(t)&&(R.push([]),E-=V,V=0),_._measuredLeft=E,R[R.length-1].push(_),V+=T),V>L.width&&(L.width=V)):this.handleInvalidState(_,e);for(D=R.length,U=0;D>U;U++){for(x=R[U],S=0,k=x.length,c=0;k>c;c++)_=x[c],_._markedForLayout&&(u=_._layoutCoefficients,g=u.top,f=u.height,p=u.sandboxHeight,m=_._measuredHeight,isNaN(m)&&(_._measuredHeight=m=f.x1*a+f.x2*(a-O)+f.x3),_._childrenLaidOut||(w=_._measuredWidth,_._childrenLaidOut=!0,_._layout._doLayout(_,isNaN(w)?t:w-_._borderLeftWidth-_._borderRightWidth,isNaN(m)?a:m-_._borderTopWidth-_._borderBottomWidth,isNaN(w),isNaN(m))),0!==g.x2?(P.push(_),C=O):_._measuredTop=C=g.x1*a+g.x3*m+g.x4+O,_._measuredSandboxHeight=b=p.x1*a+p.x2+m+C-O,b>S&&(S=b));z.push(S),O+=S}for(O=0,D=R.length,U=0;D>U;U++){for(x=R[U],S=z[U],k=x.length,c=0;k>c;c++)_=x[c],_._measuredRunningHeight=O,_._measuredRowHeight=S,~P.indexOf(_)&&_._markedForLayout&&(m=_._measuredHeight,g=_._layoutCoefficients.top,_._measuredTop=g.x1*a+g.x2*S+g.x3*m+g.x4+O);O+=S}if(L.height=O,!d)switch(this._defaultVerticalAlignment){case"end":W=a-O;case"center":W/=2}for(D=N.length,U=0;D>U;U++)_=N[U],_._markedForLayout&&(o._elementLayoutCount++,_=N[U],A=_.domNode.style,A.zIndex=_.zIndex,A.left=r(_._measuredLeft)+F,A.top=r(_._measuredTop)+F,A.width=r(_._measuredWidth-_._borderLeftWidth-_._borderRightWidth)+F,A.height=r(_._measuredHeight-_._borderTopWidth-_._borderBottomWidth)+F,_._markedForLayout=!1,_.fireEvent("postlayout"));return this._computedSize=L},_getWidth:function(e,t){return!n(t)&&(t=e._defaultWidth),t===o.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===o.SIZE?o.SIZE:o.FILL:o.FILL:t},_getHeight:function(e,t){return!n(t)&&(t=e._defaultHeight),t===o.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._height)===o.SIZE?o.SIZE:o.FILL:o.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.width.x2)&&0!==t.width.x2||!isNaN(t.height.x1)&&0!==t.height.x1||!isNaN(t.height.x2)&&0!==t.height.x2||0!==t.sandboxWidth.x1||0!==t.sandboxHeight.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,o=e._parent._measuredHeight,a=e._measuredHeight,n=e._measuredRunningWidth,r=e._measuredRunningHeight,l=e._measuredRowHeight;return{width:t.width.x1*i+t.width.x2*(i-n)+t.width.x3,height:t.height.x1*o+t.height.x2*(o-r)+t.height.x3,left:t.left.x1*i+t.left.x2+n,top:t.top.x1*o+t.top.x2*l+t.top.x3*a+t.top.x4+r}},_measureNode:function(e,t,i,a){e._needsMeasuring=!1;var n,r,l,s,d=a.getValueType,_=a.computeValue,c=a._getWidth(e,t.width),u=d(c),h=_(c,u),f=a._getHeight(e,t.height),y=d(f),p=_(f,y),g=t.left,v=d(g),I=_(g,v),w=t.right,m=d(w),b=_(w,m),T=t.top,E=d(T),C=_(T,E),x=t.bottom,S=d(x),k=_(x,S),A=i.width,L=i.height,N=i.sandboxWidth,U=i.sandboxHeight,F=i.left,O=i.top;if(n=r=l=0,u===o.SIZE?n=r=l=0/0:u===o.FILL?(r=1,"%"===v&&(n=-I),"#"===v&&(l=-I),"%"===m&&(n=-b),"#"===m&&(l=-b)):"%"===u?n=h:"#"===u&&(l=h),A.x1=n,A.x2=r,A.x3=l,n=r=0,"%"===v&&(n=I),"#"===v&&(r=I),"%"===m&&(n+=b),"#"===m&&(r+=b),N.x1=n,N.x2=r,n=r=l=0,y===o.SIZE?n=r=l=0/0:y===o.FILL?(r=1,"%"===E&&(n=-C),"#"===E&&(l=-C)):"%"===y?n=p:"#"===y&&(l=p),L.x1=n,L.x2=r,L.x3=l,U.x1="%"===S?k:0,U.x2="#"===S?k:0,F.x1="%"===v?I:0,F.x2="#"===v?I:0,n=r=l=s=0,"%"===E)n=C;else if("#"===E)s=C;else if("%"===S)n=1-k,l=-1;else if("#"===S)n=1,l=-1,s=-k;else switch(a._defaultRowAlignment){case"center":r=.5,l=-.5;break;case"end":r=1,l=-1}O.x1=n,O.x2=r,O.x3=l,O.x4=s},_defaultHorizontalAlignment:"start",_defaultVerticalAlignment:"start",_defaultRowAlignment:"center"})});