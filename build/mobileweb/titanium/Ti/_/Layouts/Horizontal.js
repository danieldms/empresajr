define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/API","Ti/UI","Ti/_/lang"],function(e,t,i,o,n){var r=n.isDef,a=Math.round,s=Math.floor,l=Math.ceil;return t("Ti._.Layouts.Horizontal",e,{_doLayout:function(e,t,n,r,d){var _,c,u,h,f,g,p,y,v,m,w,I,b,T,E,C,x,S,A,k,N={width:0,height:0},L=e._children,F=0,U="px",O=0,V=0,R=[[]],P=[],D=[],W=0,z=L.length,M=this._measureNode;for(F=0;z>F;F++)_=e._children[F],_._alive&&_.domNode?(_._measuredRunningWidth=V,_._markedForLayout&&((_._preLayout&&_._preLayout(t,n,r,d)||_._needsMeasuring)&&M(_,_,_._layoutCoefficients,this),u=_._layoutCoefficients,h=u.width,f=u.height,g=u.sandboxWidth,v=u.left,w=h.x1*t+h.x2*(t-V)+h.x3,I=0===f.x2?f.x1*n+f.x3:0/0,isNaN(w)||isNaN(f.x1)?(m=_._getContentSize?_._getContentSize(w,I):_._layout._doLayout(_,isNaN(w)?t:w-_._borderLeftWidth-_._borderRightWidth,isNaN(I)?n:I-_._borderTopWidth-_._borderBottomWidth,isNaN(w),isNaN(I)),isNaN(w)&&(w=m.width+_._borderLeftWidth+_._borderRightWidth),isNaN(f.x1)&&(I=m.height+_._borderTopWidth+_._borderBottomWidth),_._childrenLaidOut=!0,0===f.x2||isNaN(f.x2)||(i.warn("Child of width SIZE and height FILL detected in a horizontal layout. Performance degradation may occur."),_._childrenLaidOut=!1)):_._childrenLaidOut=!1,_._measuredWidth=w,_._measuredHeight=I,T=_._measuredSandboxWidth=g.x1*t+g.x2+w,E=v.x1*t+v.x2+V,!r&&s(T+V)>l(t)&&(R.push([]),E-=V,V=0),_._measuredLeft=E,R[R.length-1].push(_),V+=T),V>N.width&&(N.width=V)):this.handleInvalidState(_,e);for(z=R.length,F=0;z>F;F++){for(x=R[F],S=0,A=x.length,c=0;A>c;c++)_=x[c],_._markedForLayout&&(u=_._layoutCoefficients,y=u.top,f=u.height,p=u.sandboxHeight,I=_._measuredHeight,isNaN(I)&&(_._measuredHeight=I=f.x1*n+f.x2*(n-O)+f.x3),_._childrenLaidOut||(w=_._measuredWidth,_._childrenLaidOut=!0,_._layout._doLayout(_,isNaN(w)?t:w-_._borderLeftWidth-_._borderRightWidth,isNaN(I)?n:I-_._borderTopWidth-_._borderBottomWidth,isNaN(w),isNaN(I))),0!==y.x2?(D.push(_),C=O):_._measuredTop=C=y.x1*n+y.x3*I+y.x4+O,_._measuredSandboxHeight=b=p.x1*n+p.x2+I+C-O,b>S&&(S=b));P.push(S),O+=S}for(O=0,z=R.length,F=0;z>F;F++){for(x=R[F],S=P[F],A=x.length,c=0;A>c;c++)_=x[c],_._measuredRunningHeight=O,_._measuredRowHeight=S,~D.indexOf(_)&&_._markedForLayout&&(I=_._measuredHeight,y=_._layoutCoefficients.top,_._measuredTop=y.x1*n+y.x2*S+y.x3*I+y.x4+O);O+=S}if(N.height=O,!d)switch(this._defaultVerticalAlignment){case"end":W=n-O;case"center":W/=2}for(z=L.length,F=0;z>F;F++)_=L[F],_._markedForLayout&&(o._elementLayoutCount++,_=L[F],k=_.domNode.style,k.zIndex=_.zIndex,k.left=a(_._measuredLeft)+U,k.top=a(_._measuredTop)+U,k.width=a(_._measuredWidth-_._borderLeftWidth-_._borderRightWidth)+U,k.height=a(_._measuredHeight-_._borderTopWidth-_._borderBottomWidth)+U,_._markedForLayout=!1,_.fireEvent("postlayout"));return this._computedSize=N},_getWidth:function(e,t){return!r(t)&&(t=e._defaultWidth),t===o.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===o.SIZE?o.SIZE:o.FILL:o.FILL:t},_getHeight:function(e,t){return!r(t)&&(t=e._defaultHeight),t===o.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._height)===o.SIZE?o.SIZE:o.FILL:o.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.width.x2)&&0!==t.width.x2||!isNaN(t.height.x1)&&0!==t.height.x1||!isNaN(t.height.x2)&&0!==t.height.x2||0!==t.sandboxWidth.x1||0!==t.sandboxHeight.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,o=e._parent._measuredHeight,n=e._measuredHeight,r=e._measuredRunningWidth,a=e._measuredRunningHeight,s=e._measuredRowHeight;return{width:t.width.x1*i+t.width.x2*(i-r)+t.width.x3,height:t.height.x1*o+t.height.x2*(o-a)+t.height.x3,left:t.left.x1*i+t.left.x2+r,top:t.top.x1*o+t.top.x2*s+t.top.x3*n+t.top.x4+a}},_measureNode:function(e,t,i,n){e._needsMeasuring=!1;var r,a,s,l,d=n.getValueType,_=n.computeValue,c=n._getWidth(e,t.width),u=d(c),h=_(c,u),f=n._getHeight(e,t.height),g=d(f),p=_(f,g),y=t.left,v=d(y),m=_(y,v),w=t.right,I=d(w),b=_(w,I),T=t.top,E=d(T),C=_(T,E),x=t.bottom,S=d(x),A=_(x,S),k=i.width,N=i.height,L=i.sandboxWidth,F=i.sandboxHeight,U=i.left,O=i.top;if(r=a=s=0,u===o.SIZE?r=a=s=0/0:u===o.FILL?(a=1,"%"===v&&(r=-m),"#"===v&&(s=-m),"%"===I&&(r=-b),"#"===I&&(s=-b)):"%"===u?r=h:"#"===u&&(s=h),k.x1=r,k.x2=a,k.x3=s,r=a=0,"%"===v&&(r=m),"#"===v&&(a=m),"%"===I&&(r+=b),"#"===I&&(a+=b),L.x1=r,L.x2=a,r=a=s=0,g===o.SIZE?r=a=s=0/0:g===o.FILL?(a=1,"%"===E&&(r=-C),"#"===E&&(s=-C)):"%"===g?r=p:"#"===g&&(s=p),N.x1=r,N.x2=a,N.x3=s,F.x1="%"===S?A:0,F.x2="#"===S?A:0,U.x1="%"===v?m:0,U.x2="#"===v?m:0,r=a=s=l=0,"%"===E)r=C;else if("#"===E)l=C;else if("%"===S)r=1-A,s=-1;else if("#"===S)r=1,s=-1,l=-A;else switch(n._defaultRowAlignment){case"center":a=.5,s=-.5;break;case"end":a=1,s=-1}O.x1=r,O.x2=a,O.x3=s,O.x4=l},_defaultHorizontalAlignment:"start",_defaultVerticalAlignment:"start",_defaultRowAlignment:"center"})});