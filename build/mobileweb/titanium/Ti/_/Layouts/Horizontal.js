define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/API","Ti/UI","Ti/_/lang"],function(e,t,i,o,n){var r=n.isDef,a=Math.round,s=Math.floor,l=Math.ceil;return t("Ti._.Layouts.Horizontal",e,{_doLayout:function(e,t,n,r,d){var c,u,_,h,f,p,g,y,v,m,w,T,I,b,E,x,C,S,A,k,N={width:0,height:0},L=e._children,O=0,U="px",R=0,F=0,V=[[]],D=[],P=[],W=0,M=L.length,B=this._measureNode;for(O=0;M>O;O++)c=e._children[O],c._alive&&c.domNode?(c._measuredRunningWidth=F,c._markedForLayout&&((c._preLayout&&c._preLayout(t,n,r,d)||c._needsMeasuring)&&B(c,c,c._layoutCoefficients,this),_=c._layoutCoefficients,h=_.width,f=_.height,p=_.sandboxWidth,v=_.left,w=h.x1*t+h.x2*(t-F)+h.x3,T=0===f.x2?f.x1*n+f.x3:0/0,isNaN(w)||isNaN(f.x1)?(m=c._getContentSize?c._getContentSize(w,T):c._layout._doLayout(c,isNaN(w)?t:w-c._borderLeftWidth-c._borderRightWidth,isNaN(T)?n:T-c._borderTopWidth-c._borderBottomWidth,isNaN(w),isNaN(T)),isNaN(w)&&(w=m.width+c._borderLeftWidth+c._borderRightWidth),isNaN(f.x1)&&(T=m.height+c._borderTopWidth+c._borderBottomWidth),c._childrenLaidOut=!0,0===f.x2||isNaN(f.x2)||(i.warn("Child of width SIZE and height FILL detected in a horizontal layout. Performance degradation may occur."),c._childrenLaidOut=!1)):c._childrenLaidOut=!1,c._measuredWidth=w,c._measuredHeight=T,b=c._measuredSandboxWidth=p.x1*t+p.x2+w,E=v.x1*t+v.x2+F,!r&&s(b+F)>l(t)&&(V.push([]),E-=F,F=0),c._measuredLeft=E,V[V.length-1].push(c),F+=b),F>N.width&&(N.width=F)):this.handleInvalidState(c,e);for(M=V.length,O=0;M>O;O++){for(C=V[O],S=0,A=C.length,u=0;A>u;u++)c=C[u],c._markedForLayout&&(_=c._layoutCoefficients,y=_.top,f=_.height,g=_.sandboxHeight,T=c._measuredHeight,isNaN(T)&&(c._measuredHeight=T=f.x1*n+f.x2*(n-R)+f.x3),c._childrenLaidOut||(w=c._measuredWidth,c._childrenLaidOut=!0,c._layout._doLayout(c,isNaN(w)?t:w-c._borderLeftWidth-c._borderRightWidth,isNaN(T)?n:T-c._borderTopWidth-c._borderBottomWidth,isNaN(w),isNaN(T))),0!==y.x2?(P.push(c),x=R):c._measuredTop=x=y.x1*n+y.x3*T+y.x4+R,c._measuredSandboxHeight=I=g.x1*n+g.x2+T+x-R,I>S&&(S=I));D.push(S),R+=S}for(R=0,M=V.length,O=0;M>O;O++){for(C=V[O],S=D[O],A=C.length,u=0;A>u;u++)c=C[u],c._measuredRunningHeight=R,c._measuredRowHeight=S,~P.indexOf(c)&&c._markedForLayout&&(T=c._measuredHeight,y=c._layoutCoefficients.top,c._measuredTop=y.x1*n+y.x2*S+y.x3*T+y.x4+R);R+=S}if(N.height=R,!d)switch(this._defaultVerticalAlignment){case"end":W=n-R;case"center":W/=2}for(M=L.length,O=0;M>O;O++)c=L[O],c._markedForLayout&&(o._elementLayoutCount++,c=L[O],k=c.domNode.style,k.zIndex=c.zIndex,k.left=a(c._measuredLeft)+U,k.top=a(c._measuredTop)+U,k.width=a(c._measuredWidth-c._borderLeftWidth-c._borderRightWidth)+U,k.height=a(c._measuredHeight-c._borderTopWidth-c._borderBottomWidth)+U,c._markedForLayout=!1,c.fireEvent("postlayout"));return this._computedSize=N},_getWidth:function(e,t){return!r(t)&&(t=e._defaultWidth),t===o.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===o.SIZE?o.SIZE:o.FILL:o.FILL:t},_getHeight:function(e,t){return!r(t)&&(t=e._defaultHeight),t===o.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._height)===o.SIZE?o.SIZE:o.FILL:o.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.width.x2)&&0!==t.width.x2||!isNaN(t.height.x1)&&0!==t.height.x1||!isNaN(t.height.x2)&&0!==t.height.x2||0!==t.sandboxWidth.x1||0!==t.sandboxHeight.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,o=e._parent._measuredHeight,n=e._measuredHeight,r=e._measuredRunningWidth,a=e._measuredRunningHeight,s=e._measuredRowHeight;return{width:t.width.x1*i+t.width.x2*(i-r)+t.width.x3,height:t.height.x1*o+t.height.x2*(o-a)+t.height.x3,left:t.left.x1*i+t.left.x2+r,top:t.top.x1*o+t.top.x2*s+t.top.x3*n+t.top.x4+a}},_measureNode:function(e,t,i,n){e._needsMeasuring=!1;var r,a,s,l,d=n.getValueType,c=n.computeValue,u=n._getWidth(e,t.width),_=d(u),h=c(u,_),f=n._getHeight(e,t.height),p=d(f),g=c(f,p),y=t.left,v=d(y),m=c(y,v),w=t.right,T=d(w),I=c(w,T),b=t.top,E=d(b),x=c(b,E),C=t.bottom,S=d(C),A=c(C,S),k=i.width,N=i.height,L=i.sandboxWidth,O=i.sandboxHeight,U=i.left,R=i.top;if(r=a=s=0,_===o.SIZE?r=a=s=0/0:_===o.FILL?(a=1,"%"===v&&(r=-m),"#"===v&&(s=-m),"%"===T&&(r=-I),"#"===T&&(s=-I)):"%"===_?r=h:"#"===_&&(s=h),k.x1=r,k.x2=a,k.x3=s,r=a=0,"%"===v&&(r=m),"#"===v&&(a=m),"%"===T&&(r+=I),"#"===T&&(a+=I),L.x1=r,L.x2=a,r=a=s=0,p===o.SIZE?r=a=s=0/0:p===o.FILL?(a=1,"%"===E&&(r=-x),"#"===E&&(s=-x)):"%"===p?r=g:"#"===p&&(s=g),N.x1=r,N.x2=a,N.x3=s,O.x1="%"===S?A:0,O.x2="#"===S?A:0,U.x1="%"===v?m:0,U.x2="#"===v?m:0,r=a=s=l=0,"%"===E)r=x;else if("#"===E)l=x;else if("%"===S)r=1-A,s=-1;else if("#"===S)r=1,s=-1,l=-A;else switch(n._defaultRowAlignment){case"center":a=.5,s=-.5;break;case"end":a=1,s=-1}R.x1=r,R.x2=a,R.x3=s,R.x4=l},_defaultHorizontalAlignment:"start",_defaultVerticalAlignment:"start",_defaultRowAlignment:"center"})});