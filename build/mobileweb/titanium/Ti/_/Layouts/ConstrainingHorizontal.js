define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,t,i,o){var n=o.isDef,r=Math.round;return t("Ti._.Layouts.ConstrainingHorizontal",e,{_doLayout:function(e,t,o,n,a){var s,l,d,c,u,_,h,f,p,g,y,v,m,w,T,I,b,E={width:0,height:0},C=e._children,x=0,A="px",S=[],k=0,N=0,L=C.length,F=this._measureNode;for(x=0;L>x;x++)s=e._children[x],s._alive&&s.domNode?s._markedForLayout&&((s._preLayout&&s._preLayout(t,o,n,a)||s._needsMeasuring)&&F(s,s,s._layoutCoefficients,this),l=s._layoutCoefficients,d=l.width,0===d.x2||isNaN(d.x2)?(c=l.height,u=l.sandboxWidth,_=l.sandboxHeight,y=c.x1*o+c.x2,g=d.x1*t+d.x2*(t-k)+d.x3,p=s._getContentSize?s._getContentSize(g,y):s._layout._doLayout(s,isNaN(g)?t:g-s._borderLeftWidth-s._borderRightWidth,isNaN(y)?o:y-s._borderTopWidth-s._borderBottomWidth,isNaN(g),isNaN(y)),isNaN(g)&&(g=p.width+s._borderLeftWidth+s._borderRightWidth),isNaN(y)&&(y=p.height+s._borderTopWidth+s._borderBottomWidth),m=s._measuredSandboxWidth=u.x1*t+u.x2+g,k+=m,s._measuredWidth=g,s._measuredHeight=y):N++):this.handleInvalidState(s,e);for(I=t-k,k=Math.floor(I/N),x=0;L>x;x++)s=e._children[x],s._markedForLayout&&(l=s._layoutCoefficients,d=l.width,0===d.x2||isNaN(d.x2)||(c=l.height,u=l.sandboxWidth,_=l.sandboxHeight,y=c.x1*o+c.x2,g=d.x1*t+d.x2*(L-1>x?k:I-k*(N-1))+d.x3,p=s._getContentSize?s._getContentSize(g,y):s._layout._doLayout(s,isNaN(g)?t:g-s._borderLeftWidth-s._borderRightWidth,isNaN(y)?o:y-s._borderTopWidth-s._borderBottomWidth,isNaN(g),isNaN(y)),isNaN(g)&&(g=p.width+s._borderLeftWidth+s._borderRightWidth),isNaN(y)&&(y=p.height+s._borderTopWidth+s._borderBottomWidth),s._measuredWidth=g,s._measuredHeight=y,m=s._measuredSandboxWidth=u.x1*t+u.x2+g));for(k=0,x=0;L>x;x++)s=e._children[x],s._measuredRunningWidth=k,s._markedForLayout?(l=s._layoutCoefficients,_=l.sandboxHeight,h=l.top,f=l.left,a&&0!==h.x1?S.push(s):(y=s._measuredHeight,T=s._measuredTop=h.x1*o+h.x2*y+h.x3,v=s._measuredSandboxHeight=_.x1*o+_.x2+y+(isNaN(T)?0:T),s._measuredSandboxHeight>E.height&&(E.height=s._measuredSandboxHeight)),w=s._measuredLeft=f.x1*t+f.x2+k):s._measuredSandboxHeight>E.height&&(E.height=s._measuredSandboxHeight),k+=s._measuredSandboxWidth;for(E.width=k,L=S.length,x=0;L>x;x++)s=S[x],_=s._layoutCoefficients.sandboxHeight,v=s._measuredSandboxHeight=_.x1*o+_.x2+s._measuredHeight,v>E.height&&(E.height=v);for(x=0;L>x;x++)s=S[x],h=s._layoutCoefficients.top,_=s._layoutCoefficients.sandboxHeight,y=s._measuredHeight,v=s._measuredSandboxHeight,v>E.height&&(E.height=v),T=s._measuredTop=h.x1*E.height+h.x2*y+h.x3,s._measuredSandboxHeight+=isNaN(T)?0:T;for(L=C.length,x=0;L>x;x++)s=C[x],s._markedForLayout&&(i._elementLayoutCount++,s=C[x],b=s.domNode.style,b.zIndex=s.zIndex,b.left=r(s._measuredLeft)+A,b.top=r(s._measuredTop)+A,b.width=r(s._measuredWidth-s._borderLeftWidth-s._borderRightWidth)+A,b.height=r(s._measuredHeight-s._borderTopWidth-s._borderBottomWidth)+A,s._markedForLayout=!1,s.fireEvent("postlayout"));return this._computedSize=E},_getWidth:function(e,t){return!n(t)&&(t=e._defaultWidth),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_getHeight:function(e,t){return!n(t)&&2>n(e.top)+n(e.center&&e.center.y)+n(e.bottom)&&(t=e._defaultHeight),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._parent.height)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.width.x2)&&0!==t.width.x2||!isNaN(t.height.x1)&&0!==t.height.x1||0!==t.sandboxWidth.x1||0!==t.sandboxHeight.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,o=e._parent._measuredHeight,n=e._measuredRunningWidth,r=t.height.x1*o+t.height.x2;return{width:t.width.x1*i+t.width.x2*(i-n)+t.width.x3,height:r,left:t.left.x1*i+t.left.x2+n,top:t.top.x1*o+t.top.x2*r+t.top.x3}},_measureNode:function(e,t,o,n){e._needsMeasuring=!1;var r,a,s,l=n.getValueType,d=n.computeValue,c=n._getWidth(e,t.width),u=l(c),_=d(c,u),h=n._getHeight(e,t.height),f=l(h),p=d(h,f),g=t.left,y=l(g),v=d(g,y),m=t.right,w=l(m),T=d(m,w),I=t.top,b=l(I),E=d(I,b),C=t.center&&t.center.y,x=l(C),A=d(C,x),S=t.bottom,k=l(S),N=d(S,k),L=o.width,F=o.height,O=o.sandboxWidth,U=o.sandboxHeight,R=o.left,V=o.top;if(r=a=0,f===i.SIZE?r=a=0/0:f===i.FILL?(r=1,"%"===b?r-=E:"#"===b?a=-E:"%"===k?r-=N:"#"===k&&(a=-N)):"%"===f?r=p:"#"===f?a=p:"%"===b?"%"===x?r=2*(A-E):"#"===x?(r=-2*E,a=2*A):"%"===k?r=1-E-N:"#"===k&&(r=1-E,a=-N):"#"===b?"%"===x?(r=2*A,a=-2*E):"#"===x?a=2*(A-E):"%"===k?(r=1-N,a=-E):"#"===k&&(r=1,a=-N-E):"%"===x?"%"===k?r=2*(N-A):"#"===k&&(r=-2*A,a=2*N):"#"===x&&("%"===k?(r=2*N,a=-2*A):"#"===k&&(a=2*(N-A))),F.x1=r,F.x2=a,U.x1="%"===k?N:0,U.x2="#"===k?N:0,r=a=s=0,u===i.SIZE?r=a=s=0/0:u===i.FILL?(a=1,"%"===y&&(r=-v),"#"===y&&(s=-v),"%"===w&&(r=-T),"#"===w&&(s=-T)):"%"===u?r=_:"#"===u&&(s=_),L.x1=r,L.x2=a,L.x3=s,r=a=0,"%"===y&&(r=v),"#"===y&&(a=v),"%"===w&&(r+=T),"#"===w&&(a+=T),O.x1=r,O.x2=a,r=a=s=0,"%"===b)r=E;else if("#"===b)s=E;else if("%"===x)r=A,a=-.5;else if("#"===x)a=-.5,s=A;else if("%"===k)r=1-N,a=-1;else if("#"===k)r=1,a=-1,s=-N;else switch(n._defaultVerticalAlignment){case"center":r=.5,a=-.5;break;case"end":r=1,a=-1}V.x1=r,V.x2=a,V.x3=s,R.x1="%"===y?v:0,R.x2="#"===y?v:0},_defaultHorizontalAlignment:"start",_defaultVerticalAlignment:"center"})});