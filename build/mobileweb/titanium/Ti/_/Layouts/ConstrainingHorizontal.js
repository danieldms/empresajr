define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,t,i,o){var n=o.isDef,a=Math.round;return t("Ti._.Layouts.ConstrainingHorizontal",e,{_doLayout:function(e,t,o,n,r){var l,s,d,_,c,u,h,f,y,p,g,v,w,I,m,b,T,E={width:0,height:0},C=e._children,S=0,k="px",x=[],A=0,L=0,N=C.length,U=this._measureNode;for(S=0;N>S;S++)l=e._children[S],l._alive&&l.domNode?l._markedForLayout&&((l._preLayout&&l._preLayout(t,o,n,r)||l._needsMeasuring)&&U(l,l,l._layoutCoefficients,this),s=l._layoutCoefficients,d=s.width,0===d.x2||isNaN(d.x2)?(_=s.height,c=s.sandboxWidth,u=s.sandboxHeight,g=_.x1*o+_.x2,p=d.x1*t+d.x2*(t-A)+d.x3,y=l._getContentSize?l._getContentSize(p,g):l._layout._doLayout(l,isNaN(p)?t:p-l._borderLeftWidth-l._borderRightWidth,isNaN(g)?o:g-l._borderTopWidth-l._borderBottomWidth,isNaN(p),isNaN(g)),isNaN(p)&&(p=y.width+l._borderLeftWidth+l._borderRightWidth),isNaN(g)&&(g=y.height+l._borderTopWidth+l._borderBottomWidth),w=l._measuredSandboxWidth=c.x1*t+c.x2+p,A+=w,l._measuredWidth=p,l._measuredHeight=g):L++):this.handleInvalidState(l,e);for(b=t-A,A=Math.floor(b/L),S=0;N>S;S++)l=e._children[S],l._markedForLayout&&(s=l._layoutCoefficients,d=s.width,0===d.x2||isNaN(d.x2)||(_=s.height,c=s.sandboxWidth,u=s.sandboxHeight,g=_.x1*o+_.x2,p=d.x1*t+d.x2*(N-1>S?A:b-A*(L-1))+d.x3,y=l._getContentSize?l._getContentSize(p,g):l._layout._doLayout(l,isNaN(p)?t:p-l._borderLeftWidth-l._borderRightWidth,isNaN(g)?o:g-l._borderTopWidth-l._borderBottomWidth,isNaN(p),isNaN(g)),isNaN(p)&&(p=y.width+l._borderLeftWidth+l._borderRightWidth),isNaN(g)&&(g=y.height+l._borderTopWidth+l._borderBottomWidth),l._measuredWidth=p,l._measuredHeight=g,w=l._measuredSandboxWidth=c.x1*t+c.x2+p));for(A=0,S=0;N>S;S++)l=e._children[S],l._measuredRunningWidth=A,l._markedForLayout?(s=l._layoutCoefficients,u=s.sandboxHeight,h=s.top,f=s.left,r&&0!==h.x1?x.push(l):(g=l._measuredHeight,m=l._measuredTop=h.x1*o+h.x2*g+h.x3,v=l._measuredSandboxHeight=u.x1*o+u.x2+g+(isNaN(m)?0:m),l._measuredSandboxHeight>E.height&&(E.height=l._measuredSandboxHeight)),I=l._measuredLeft=f.x1*t+f.x2+A):l._measuredSandboxHeight>E.height&&(E.height=l._measuredSandboxHeight),A+=l._measuredSandboxWidth;for(E.width=A,N=x.length,S=0;N>S;S++)l=x[S],u=l._layoutCoefficients.sandboxHeight,v=l._measuredSandboxHeight=u.x1*o+u.x2+l._measuredHeight,v>E.height&&(E.height=v);for(S=0;N>S;S++)l=x[S],h=l._layoutCoefficients.top,u=l._layoutCoefficients.sandboxHeight,g=l._measuredHeight,v=l._measuredSandboxHeight,v>E.height&&(E.height=v),m=l._measuredTop=h.x1*E.height+h.x2*g+h.x3,l._measuredSandboxHeight+=isNaN(m)?0:m;for(N=C.length,S=0;N>S;S++)l=C[S],l._markedForLayout&&(i._elementLayoutCount++,l=C[S],T=l.domNode.style,T.zIndex=l.zIndex,T.left=a(l._measuredLeft)+k,T.top=a(l._measuredTop)+k,T.width=a(l._measuredWidth-l._borderLeftWidth-l._borderRightWidth)+k,T.height=a(l._measuredHeight-l._borderTopWidth-l._borderBottomWidth)+k,l._markedForLayout=!1,l.fireEvent("postlayout"));return this._computedSize=E},_getWidth:function(e,t){return!n(t)&&(t=e._defaultWidth),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getWidth(e._parent,e._parent.width)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_getHeight:function(e,t){return!n(t)&&2>n(e.top)+n(e.center&&e.center.y)+n(e.bottom)&&(t=e._defaultHeight),t===i.INHERIT?e._parent._parent?e._parent._parent._layout._getHeight(e._parent,e._parent.height)===i.SIZE?i.SIZE:i.FILL:i.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.width.x2)&&0!==t.width.x2||!isNaN(t.height.x1)&&0!==t.height.x1||0!==t.sandboxWidth.x1||0!==t.sandboxHeight.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,o=e._parent._measuredHeight,n=e._measuredRunningWidth,a=t.height.x1*o+t.height.x2;return{width:t.width.x1*i+t.width.x2*(i-n)+t.width.x3,height:a,left:t.left.x1*i+t.left.x2+n,top:t.top.x1*o+t.top.x2*a+t.top.x3}},_measureNode:function(e,t,o,n){e._needsMeasuring=!1;var a,r,l,s=n.getValueType,d=n.computeValue,_=n._getWidth(e,t.width),c=s(_),u=d(_,c),h=n._getHeight(e,t.height),f=s(h),y=d(h,f),p=t.left,g=s(p),v=d(p,g),w=t.right,I=s(w),m=d(w,I),b=t.top,T=s(b),E=d(b,T),C=t.center&&t.center.y,S=s(C),k=d(C,S),x=t.bottom,A=s(x),L=d(x,A),N=o.width,U=o.height,F=o.sandboxWidth,O=o.sandboxHeight,V=o.left,P=o.top;if(a=r=0,f===i.SIZE?a=r=0/0:f===i.FILL?(a=1,"%"===T?a-=E:"#"===T?r=-E:"%"===A?a-=L:"#"===A&&(r=-L)):"%"===f?a=y:"#"===f?r=y:"%"===T?"%"===S?a=2*(k-E):"#"===S?(a=-2*E,r=2*k):"%"===A?a=1-E-L:"#"===A&&(a=1-E,r=-L):"#"===T?"%"===S?(a=2*k,r=-2*E):"#"===S?r=2*(k-E):"%"===A?(a=1-L,r=-E):"#"===A&&(a=1,r=-L-E):"%"===S?"%"===A?a=2*(L-k):"#"===A&&(a=-2*k,r=2*L):"#"===S&&("%"===A?(a=2*L,r=-2*k):"#"===A&&(r=2*(L-k))),U.x1=a,U.x2=r,O.x1="%"===A?L:0,O.x2="#"===A?L:0,a=r=l=0,c===i.SIZE?a=r=l=0/0:c===i.FILL?(r=1,"%"===g&&(a=-v),"#"===g&&(l=-v),"%"===I&&(a=-m),"#"===I&&(l=-m)):"%"===c?a=u:"#"===c&&(l=u),N.x1=a,N.x2=r,N.x3=l,a=r=0,"%"===g&&(a=v),"#"===g&&(r=v),"%"===I&&(a+=m),"#"===I&&(r+=m),F.x1=a,F.x2=r,a=r=l=0,"%"===T)a=E;else if("#"===T)l=E;else if("%"===S)a=k,r=-.5;else if("#"===S)r=-.5,l=k;else if("%"===A)a=1-L,r=-1;else if("#"===A)a=1,r=-1,l=-L;else switch(n._defaultVerticalAlignment){case"center":a=.5,r=-.5;break;case"end":a=1,r=-1}P.x1=a,P.x2=r,P.x3=l,V.x1="%"===g?v:0,V.x2="#"===g?v:0},_defaultHorizontalAlignment:"start",_defaultVerticalAlignment:"center"})});