define(["Ti/_","Ti/_/has","Ti/_/lang"],function(e,t,i){function o(e,t,i){var o,n=t-10;for(_(e.arg,"String")||(e.arg=""+e.arg);n>e.arg.length;)e.arg=e.rightJustify?e.arg+i:i+e.arg;o=t-e.arg.length,e.arg=e.rightJustify?e.arg+i.substring(0,o):i.substring(0,o)+e.arg}function n(e,t){o(e,i.val(t,e.precision),h)}function r(e,t){o(e,i.val(t,e.minWidth),f)}function a(e){e.maxWidth>=0&&e.arg.length>e.maxWidth?e.arg.substring(0,e.maxWidth):e.zeroPad?n(e,e.minWidth):r(e)}function s(e){var t=parseInt(e.arg);isFinite(t)||(d(!_(e.arg,"Number"),"Format argument '"+e.arg+"' not an integer; parseInt returned "+t),t=0),0>t&&(e.isUnsigned||10!=e.base)&&(t=4294967295+t+1),0>t?(e.arg=(-t).toString(e.base),n(e),e.arg="-"+e.arg):(e.arg=t.toString(e.base),t||e.precision?n(e):e.arg="",e.sign&&(e.arg=e.sign+e.arg)),16===e.base&&(e.alternative&&(e.arg="0x"+e.arg),e.arg=e.toUpper?e.arg.toUpperCase():e.arg.toLowerCase()),8===e.base&&e.alternative&&"0"!=e.arg.charAt(0)&&(e.arg="0"+e.arg)}function l(e){var t=parseFloat(e.arg);switch(isFinite(t)||(d(!_(e.arg,"Number"),"Format argument '"+e.arg+"' not a float; parseFloat returned "+t),t=0),e.specifier){case"e":e.arg=t.toExponential(e.precision);break;case"f":e.arg=t.toFixed(e.precision);break;case"g":e.arg=1e-4>Math.abs(t)?t.toExponential(e.precision>0?e.precision-1:e.precision):t.toPrecision(e.precision),e.alternative||(e.arg=e.arg.replace(/(\..*[^0])0*/,"$1"),e.arg=e.arg.replace(/\.0*e/,"e").replace(/\.0$/,""));break;default:throw Error("Unexpected double notation '"+e.doubleNotation+"'")}e.arg=e.arg.replace(/e\+(\d)$/,"e+0$1").replace(/e\-(\d)$/,"e-0$1"),u&&(e.arg=e.arg.replace(/^\./,"0.")),e.alternative&&(e.arg=e.arg.replace(/^(\d+)$/,"$1."),e.arg=e.arg.replace(/^(\d+)e/,"$1.e")),t>=0&&e.sign&&(e.arg=e.sign+e.arg),e.arg=e.toUpper?e.arg.toUpperCase():e.arg.toLowerCase()}var d=e.assert,_=require.is,c=require.mix,u=t("opera"),h="0000000000",f="          ",p={b:{base:2,isInt:1},o:{base:8,isInt:1},x:{base:16,isInt:1},X:{extend:["x"],toUpper:1},d:{base:10,isInt:1},i:{extend:["d"]},u:{extend:["d"],isUnsigned:1},c:{setArg:function(e){if(!isNaN(e.arg)){var t=parseInt(e.arg);d(0>t||t>127,"Invalid character code passed to %c in sprintf"),e.arg=isNaN(t)?""+t:String.fromCharCode(t)}}},s:{setMaxWidth:function(e){e.maxWidth="."===e.period?e.precision:-1}},e:{isDouble:1},E:{extend:["e"],toUpper:1},f:{isDouble:1},F:{extend:["f"]},g:{isDouble:1},G:{extend:["g"],toUpper:1}};return String.format=function(e){for(var t,o,n,r,h=i.toArray(arguments),f=/\%(?:\(([\w_]+)\)|([1-9]\d*)\$)?([0 +\-\#]*)(\*|\d+)?(\.)?(\*|\d+)?[hlL]?([\%scdeEfFgGiouxX])/g,g=[],y=0,v=0,m=0,w="",I=["mapping","intmapping","flags","_minWidth","period","_precision","specifier"];o=f.exec(e);){if(r=e.slice(v,f.lastIndex-o[0].length),r.length&&g.push(r),u){for(n=o.slice(0);n.length<o.length;)n.push(null);o=n}t={},o.slice(1).concat(g.length).map(function(e,i){I[i]&&(t[I[i]]=e)}),g.push(t),t[0]&&y++,v=f.lastIndex}return r=e.slice(v),r.length&&g.push(r),h.shift(),d(!y||h.length,"Format has no mapped arguments"),g.forEach(function(t){var i,o,n,r={},u=p[t.specifier];if(_(t,"String"))w+=t;else{if(y?d(void 0===h[t.mapping],"Missing key "+t.mapping):(t.intmapping&&(m=parseInt(t.intmapping)-1),d(h.length>m,"Got "+h.length+" format arguments, insufficient for '"+e+"'")),t.arg=h[y?t.mapping:m++],!t.compiled){for(c(t,{compiled:1,sign:"",zeroPad:0,rightJustify:0,alternative:0,minWidth:0|t._minWidth,maxWidth:-1,toUpper:0,isUnsigned:0,isInt:0,isDouble:0,precision:"."===t.period?0|t._precision:1}),i=t.flags,o=i.length;o--;)switch(r[n=i.charAt(o)]=1,n){case" ":t.sign=" ";break;case"+":t.sign="+";break;case"0":t.zeroPad=!r["-"];break;case"-":t.rightJustify=1,t.zeroPad=0;break;case"#":t.alternative=1;break;default:throw Error("Bad formatting flag '"+n+"'")}d(void 0!==u,"Unexpected specifier '"+t.specifier+"'"),u.extend&&(c(u,p[u.extend]),delete u.extend),c(t,u)}_(t.setArg,"Function")&&t.setArg(t),_(t.setMaxWidth,"Function")&&t.setMaxWidth(t),"*"===t._minWidth&&(d(y,"* width not supported in mapped formats"),d(isNaN(t.minWidth=parseInt(h[m++])),"The argument for * width at position "+m+" is not a number in "+this._format),0>t.minWidth&&(t.rightJustify=1,t.minWidth=-t.minWidth)),"*"===t._precision&&"."===t.period&&(d(y,"* precision not supported in mapped formats"),d(isNaN(t.precision=parseInt(h[m++])),"The argument for * precision at position "+m+" is not a number in "+this._format),0>t.precision&&(t.precision=1,t.period="")),t.isInt?("."===t.period&&(t.zeroPad=0),s(t)):t.isDouble&&("."!==t.period&&(t.precision=6),l(t)),a(t),w+=""+t.arg}}),w},{capitalize:function(e){return e=e||"",e.substring(0,1).toUpperCase()+e.substring(1)},trim:String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}});