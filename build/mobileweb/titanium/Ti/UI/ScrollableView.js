define(["Ti/_/declare","Ti/UI/View","Ti/_/dom","Ti/_/has","Ti/_/style","Ti/UI","Ti/_/browser"],function(e,t,i,o,l,a,r){var n=l.set,s=require.is,d=i.unitize,_=require.on,c=_.once,u=window,y={webkit:"webkitTransitionEnd",trident:"msTransitionEnd",gecko:"transitionend",presto:"oTransitionEnd"},f=y[r.runtime]||"transitionEnd",h=o("touch"),p=200,v=10,g=25,I=1e3,w=.5,m=2;return e("Ti.UI.ScrollableView",t,{constructor:function(){var e,t=this,i=0;t._add(t._contentContainer=a.createView({left:0,top:0,width:a.SIZE,height:"100%",layout:"constrainingHorizontal"})),e=t._contentContainer.domNode,t._add(t._pagingControlContainer=a.createView({width:"100%",height:20,bottom:0,backgroundColor:"black",opacity:0,touchEnabled:!1})),t._pagingControlContainer._add(t._pagingControlContentContainer=a.createView({width:a.SIZE,height:"100%",top:0,touchEnabled:!1,layout:"constrainingHorizontal"})),t.properties.__values__.views=[],t._viewToRemoveAfterScroll=-1,_(t,"postlayout",function(){t._animating||t._setTranslation(t.currentPage*-t._measuredWidth)}),_(e,h?"touchstart":"mousedown",function(o){var l=o.touches?o.touches[0].clientX:o.clientX,a=l,r=Date.now(),s=t._measuredWidth,d=function(e){var o=t.currentPage,r=a-l+i;s=t._measuredWidth,e.preventDefault(),a=e.touches?e.touches[0].clientX:e.clientX,t._setTranslation(o*-s+r),t.fireEvent("scroll",{currentPage:o,currentPageAsFloat:o-r/s,view:t.views[o]})},_=function(o){var y=Date.now(),b=p>y-r,T=t.currentPage,E=Math.abs(l-a)>(b?v:s/2),C=t.properties.__values__,S=Math.abs(a-l);u.removeEventListener(h?"touchmove":"mousemove",d),u.removeEventListener(h?"touchend":"mouseup",_),s=t._measuredWidth,t._animating=1,o.preventDefault(),E&&(l>a?T!==C.views.length-1&&T++:0!==T&&T--,S=s-S),t._showPagingControl(T),i=a-l+i,S=Math.max(g,Math.min(I,(b?w:m)*S)),n(e,"transition",S+"ms ease-out"),setTimeout(function(){c(e,f,function(){n(e,"transition",""),t._animating=0,C.currentPage=T,t._updatePagingControl(),t.fireEvent("scrollend",{currentPage:T,view:t.views[T]})}),t._setTranslation(T*-s)},1),t.fireEvent("dragend",{currentPage:T,view:t.views[T]})};t._showPagingControl(t.currentPage,1),o.preventDefault(),i=t._animating?i||0:0,n(e,"transition",""),t._setTranslation(t.currentPage*-s+i),t._animating=0,u.addEventListener(h?"touchmove":"mousemove",d),u.addEventListener(h?"touchend":"mouseup",_),t.fireEvent("dragstart")})},_setTranslation:function(e){n(this._contentContainer.domNode,"transform","translatez(0) translatex("+e+"px)")},_showPagingControl:function(e,t){var i=this;return i.showPagingControl?(i._pagingAnimation&&i._pagingAnimation.cancel(),i._pagingAnimation=i._pagingControlContainer.animate({duration:250,opacity:.75}),clearInterval(i._pagingTimeout),!t&&i.pagingControlTimeout>0?i._pagingTimeout=setTimeout(function(){i._pagingAnimation&&i._pagingAnimation.cancel(),i._pagingAnimation=i._pagingControlContainer.animate({duration:750,opacity:0},function(){i._pagingAnimation=void 0})},i.pagingControlTimeout):i._pagingAnimation=void 0,void 0):(i._pagingControlContainer.opacity=0,void 0)},_updatePagingControl:function(){var e=this._pagingControlContentContainer,t=this.views.length,i=this.pagingControlHeight/2;if(t!==e._numViews||i!==e._diameter){e._numViews=t,e._diameter=i,e._removeAllChildren();for(var o=0;this.views.length>o;o++)e._add(a.createView({width:i,height:i,left:5,right:5,backgroundColor:"#aaa",borderRadius:d(i/2)}));e._highlightedPage=-1}e._highlightedPage!==this.currentPage&&(0>e._highlightedPage||(e._children[e._highlightedPage].backgroundColor="#aaa"),e._children[this.currentPage].backgroundColor="#fff",e._highlightedPage=this.currentPage)},addView:function(e){e&&(e.width="100%",e.height="100%",this.views.push(e),this._contentContainer._add(e),1==this.views.length&&(this.properties.__values__.currentPage=0),this._updatePagingControl())},removeView:function(e){var t=s(e,"Number")?e:this.views.indexOf(e);0>t||t>=this.views.length||(t==this.currentPage&&1!==this.views.length?(this._viewToRemoveAfterScroll=t,this.scrollToView(t==this.views.length-1?--t:++t)):this._removeViewFromList(t))},_removeViewFromList:function(e){var t=this._contentContainer,i=this;this.currentPage>e&&i.properties.__values__.currentPage--,t._remove(i.views.splice(e,1)[0]),i.views.length||(i.properties.__values__.currentPage=-1),c(a,"postlayout",function(){setTimeout(function(){i._setTranslation(i.currentPage*-i._measuredWidth)},1)})},scrollToView:function(e,t){function i(){var e=l._contentContainer,i=e.domNode,a=-l.views[o]._measuredLeft,r=Math.max(g,Math.min(I,m*e._measuredWidth));l._updatePagingControl(),l._showPagingControl(o),t?(l._setTranslation(a),l.properties.__values__.currentPage=o):(n(i,"transition",r+"ms ease-out"),setTimeout(function(){c(i,f,function(){n(i,"transition",""),l._animating=0,l.properties.__values__.currentPage=o,l._updatePagingControl(),-1!==l._viewToRemoveAfterScroll&&(a+=l.views[l._viewToRemoveAfterScroll]._measuredWidth,l._removeViewFromList(l._viewToRemoveAfterScroll),l._viewToRemoveAfterScroll=-1),l.fireEvent("scrollend",{currentPage:o,view:l.views[o]})}),l._setTranslation(a)},1))}var o=s(e,"Number")?e:this.views.indexOf(e),l=this;0>o||o>=this.views.length||o==this.currentPage||(l._contentContainer.domNode.offsetWidth?i():c(l,"postlayout",i))},_defaultWidth:a.FILL,_defaultHeight:a.FILL,properties:{currentPage:{set:function(e,t){return e>=0&&this.views.length>e?(this.scrollToView(e,1),e):t},value:-1},pagingControlColor:{set:function(e){return this._pagingControlContainer.backgroundColor=e,e},value:"black"},pagingControlHeight:{set:function(e){return this._pagingControlContainer.height=e,e},value:20},pagingControlTimeout:{post:function(e){e||(this._pagingControlContainer.opacity=.75)},value:3e3},showPagingControl:!1,views:{set:function(e){if(s(e,"Array")){var t,i=0,o=e.length,l=this._contentContainer;for(l._removeAllChildren();o>i;i++)(t=e[i]).width="100%",t.height="100%",l._add(t);return this.properties.__values__.currentPage=o?0:-1,e}},post:"_updatePagingControl"}}})});