define(["Ti/_/declare","Ti/_/Evented","Ti/_/lang","Ti/Platform"],function(e,t,i,o){function r(e,t,i){var o=0==t?1:0,r=2==t?1:2,a=0==e?1:0,n=2==e?1:2;return i[a][o]*i[n][r]-i[a][r]*i[n][o]}function a(e,t,i,o,r,a,n,l){return{a:e.a*t+e.b*o,b:e.a*i+e.b*r,c:e.c*t+e.d*o,d:e.c*i+e.d*r,tx:e.a*a+e.b*n+e.tx,ty:e.c*a+e.d*n+e.ty,rotation:e.rotation+(0|l)}}var n,l="gecko"===o.runtime,s=function(e){return l?e+"px":e};return n=e("Ti.UI.2DMatrix",t,{properties:{a:1,b:0,c:0,d:1,tx:0,ty:0,rotation:0},constructor:function(e){e&&require.mix(this,e)},invert:function(){var e=0,t=0,i=[[this.a,this.b,this.tx],[this.c,this.d,this.ty],[0,0,1]],o=i,l=this.a*r(0,0,i)-this.b*r(0,1,i)+this.tx*r(0,2,i);if(Math.abs(l)>1e-10)for(l=1/l;3>t;t++)for(;3>e;e++)o[t][e]=r(e,t,i)*l,1==(e+t)%2&&(o[t][e]=-o[t][e]);return new n(a(this,o[0][0],o[0][1],o[1][0],o[1][1],o[0][2],o[1][2]))},multiply:function(e){return new n(a(this,e.a,e.b,e.c,e.d,e.tx,e.ty,e.rotation))},rotate:function(e){return new n({a:this.a,b:this.b,c:this.c,d:this.d,tx:this.tx,ty:this.ty,rotation:this.rotation+e})},scale:function(e,t){return new n(a(this,e,0,0,i.val(t,e),0,0))},translate:function(e,t){return new n(a(this,1,0,0,1,e,t))},toCSS:function(){for(var e=0,t=[this.a,this.b,this.c,this.d,this.tx,this.ty];6>e;e++)t[e]=t[e].toFixed(6),e>4&&(t[e]=s(t[e]));return"matrix("+t.join(",")+") rotate("+this.rotation+"deg)"}})});