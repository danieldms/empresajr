define(["Ti/_/Evented","Ti/_/lang"],function(e,t){function i(){FB.init({appId:d,status:!1,cookie:!0,oauth:!0,xfbml:!0}),FB.getLoginStatus(function(e){n=!0,"connected"==e.status&&o(e)||s&&a()},!0)}function o(e){var t=e.authResponse;return t?(r.loggedIn=!0,r.uid=t.userID,r.expirationDate=new Date(Date.now()+1e3*t.expiresIn),r.accessToken=t.accessToken,t.expiresIn&&setTimeout(function(){r.logout()},1e3*t.expiresIn),r.fireEvent("login",{cancelled:!1,data:e,success:!0,uid:r.uid}),!0):void 0}function l(e,t,i,o){result={source:r,success:!1},result[t]=i,!e||e.error?e&&(result.error=e.error):(result.success=!0,result.result=JSON.stringify(e)),o(result)}function a(){FB.login(function(e){o(e)||r.fireEvent("login",{cancelled:!0,data:e,error:"user cancelled or an internal error occured.",success:!1,uid:e.id})},{scope:r.permissions.join()})}var r,n=!1,s=!1,d=null,_="not logged in",c=document.createElement("div"),y="facebook-jssdk",u=!1;if(r=t.setObject("Ti.Facebook",e,{authorize:function(){if(!d)throw Error("App ID not set. Facebook authorization cancelled.");n?a():s=!0},createLoginButton:function(e){return new(require("Ti/Facebook/LoginButton"))(e)},dialog:function(e,t,i){r.loggedIn?(t.method=e,FB.ui(t,function(t){l(t,"action",e,i)})):i({success:!1,error:_,action:e,source:r})},logout:function(){r.loggedIn&&FB.logout(function(){r.loggedIn=!1,r.fireEvent("logout",{success:!0})})},request:function(e,t,i){r.loggedIn?(t.method=e,t.urls="facebook.com,developers.facebook.com",FB.api(t,function(t){l(t,"method",e,i)})):i({success:!1,error:_,method:e,source:r})},requestWithGraphPath:function(e,t,i,o){r.loggedIn?FB.api(e,i,t,function(t){l(t,"path",e,o)}):o({success:!1,error:_,path:e,source:r})},constants:{BUTTON_STYLE_NORMAL:1,BUTTON_STYLE_WIDE:2},properties:{accessToken:void 0,appid:{set:function(e){return d=e,u&&i(),e}},expirationDate:void 0,forceDialogAuth:!0,loggedIn:!1,permissions:void 0,uid:void 0}}),c.id="fb-root",document.body.appendChild(c),!document.getElementById(y)){var f=document.createElement("script"),h=document.getElementsByTagName("head")[0];f.id=y,f.async=!0,f.src="//connect.facebook.net/en_US/all.js",h.insertBefore(f,h.firstChild)}return window.fbAsyncInit=function(){u=!0,d&&i()},r});