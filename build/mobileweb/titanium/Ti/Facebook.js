define(["Ti/_/Evented","Ti/_/lang"],function(e,t){function i(){FB.init({appId:d,status:!1,cookie:!0,oauth:!0,xfbml:!0}),FB.getLoginStatus(function(e){n=!0,"connected"==e.status&&o(e)||s&&r()},!0)}function o(e){var t=e.authResponse;return t?(l.loggedIn=!0,l.uid=t.userID,l.expirationDate=new Date(Date.now()+1e3*t.expiresIn),l.accessToken=t.accessToken,t.expiresIn&&setTimeout(function(){l.logout()},1e3*t.expiresIn),l.fireEvent("login",{cancelled:!1,data:e,success:!0,uid:l.uid}),!0):void 0}function a(e,t,i,o){result={source:l,success:!1},result[t]=i,!e||e.error?e&&(result.error=e.error):(result.success=!0,result.result=JSON.stringify(e)),o(result)}function r(){FB.login(function(e){o(e)||l.fireEvent("login",{cancelled:!0,data:e,error:"user cancelled or an internal error occured.",success:!1,uid:e.id})},{scope:l.permissions.join()})}var l,n=!1,s=!1,d=null,_="not logged in",c=document.createElement("div"),u="facebook-jssdk",f=!1;if(l=t.setObject("Ti.Facebook",e,{authorize:function(){if(!d)throw Error("App ID not set. Facebook authorization cancelled.");n?r():s=!0},createLoginButton:function(e){return new(require("Ti/Facebook/LoginButton"))(e)},dialog:function(e,t,i){l.loggedIn?(t.method=e,FB.ui(t,function(t){a(t,"action",e,i)})):i({success:!1,error:_,action:e,source:l})},logout:function(){l.loggedIn&&FB.logout(function(){l.loggedIn=!1,l.fireEvent("logout",{success:!0})})},request:function(e,t,i){l.loggedIn?(t.method=e,t.urls="facebook.com,developers.facebook.com",FB.api(t,function(t){a(t,"method",e,i)})):i({success:!1,error:_,method:e,source:l})},requestWithGraphPath:function(e,t,i,o){l.loggedIn?FB.api(e,i,t,function(t){a(t,"path",e,o)}):o({success:!1,error:_,path:e,source:l})},constants:{BUTTON_STYLE_NORMAL:1,BUTTON_STYLE_WIDE:2},properties:{accessToken:void 0,appid:{set:function(e){return d=e,f&&i(),e}},expirationDate:void 0,forceDialogAuth:!0,loggedIn:!1,permissions:void 0,uid:void 0}}),c.id="fb-root",document.body.appendChild(c),!document.getElementById(u)){var h=document.createElement("script"),y=document.getElementsByTagName("head")[0];h.id=u,h.async=!0,h.src="//connect.facebook.net/en_US/all.js",y.insertBefore(h,y.firstChild)}return window.fbAsyncInit=function(){f=!0,d&&i()},l});